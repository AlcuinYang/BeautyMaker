# AestheticsEngineï¼ˆç¾å­¦å¼•æ“ï¼‰å®Œæ•´é¡¹ç›®æ–‡æ¡£

**æœ€åæ›´æ–°æ—¶é—´ï¼š** 2025-11-05
**ç‰ˆæœ¬ï¼š** 0.1.0
**ä½œè€…ï¼š** Aesthetic Engine Team

---

## ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æ ¸å¿ƒç‰¹æ€§](#æ ¸å¿ƒç‰¹æ€§)
3. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
4. [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
5. [æ ¸å¿ƒæ¨¡å—è¯¦è§£](#æ ¸å¿ƒæ¨¡å—è¯¦è§£)
6. [APIæ¥å£æ–‡æ¡£](#apiæ¥å£æ–‡æ¡£)
7. [å·¥ä½œæµç¨‹](#å·¥ä½œæµç¨‹)
8. [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
9. [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)
10. [å¼€å‘æŒ‡å—](#å¼€å‘æŒ‡å—)
11. [å‰ç«¯åº”ç”¨](#å‰ç«¯åº”ç”¨)
12. [æŠ€æœ¯äº®ç‚¹](#æŠ€æœ¯äº®ç‚¹)
13. [å¾…åŠäº‹é¡¹](#å¾…åŠäº‹é¡¹)
14. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## é¡¹ç›®æ¦‚è¿°

### ç®€ä»‹

**AestheticsEngineï¼ˆç¾å­¦å¼•æ“ï¼‰** æ˜¯ä¸€ä¸ªæ¨¡å—åŒ–çš„AIç¾å­¦è¯„ä¼°å’Œå›¾åƒç”Ÿæˆå¼•æ“ï¼Œé›†æˆäº†ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

- **å¤šæºå›¾åƒç”Ÿæˆ**ï¼šæ”¯æŒ13+ä¸ªä¸»æµå›¾åƒç”ŸæˆæœåŠ¡æä¾›å•†ï¼ˆOpenAI DALLÂ·Eã€é€šä¹‰åƒé—®ã€è±†åŒ…Seedreamã€Geminiç­‰ï¼‰
- **å¤šç»´ç¾å­¦è¯„åˆ†**ï¼šé‡‡ç”¨è±†åŒ…Visionæ¨¡å‹è¿›è¡Œ5ç»´åº¦ç¾å­¦è¯„åˆ†ï¼ˆæ„å›¾ã€å…‰å½±ã€é£æ ¼ã€æƒ…æ„Ÿã€æ¸…æ™°åº¦ï¼‰+ ç»¼åˆè¯„åˆ†
- **å›¾åƒå¢å¼º**ï¼šé¢„ç•™è¶…åˆ†è¾¨ç‡ã€å»å™ªç­‰å›¾åƒå¤„ç†èƒ½åŠ›
- **æ™ºèƒ½é€‰ä¼˜**ï¼šåŸºäºç¾å­¦è¯„åˆ†è‡ªåŠ¨é€‰æ‹©æœ€ä½³å€™é€‰å›¾ç‰‡
- **æ™ºèƒ½ç®¡çº¿**ï¼šæä¾›æ–‡ç”Ÿå›¾å’Œå›¾ç”Ÿå›¾ä¸¤ç§å®Œæ•´çš„ç”Ÿæˆ+è¯„åˆ†+é€‰ä¼˜å·¥ä½œæµ

### æŠ€æœ¯å®šä½

- **åç«¯**ï¼šåŸºäºFastAPIçš„å¾®æœåŠ¡æ¶æ„ï¼Œé‡‡ç”¨å¼‚æ­¥ç¼–ç¨‹å®ç°é«˜å¹¶å‘
- **å‰ç«¯**ï¼šReact 19 + TypeScript + Tailwind CSSï¼Œæä¾›Appleé£æ ¼çš„ç”¨æˆ·ç•Œé¢
- **AIé›†æˆ**ï¼šæ·±åº¦é›†æˆè±†åŒ…Visionå¤šæ¨¡æ€å¤§æ¨¡å‹ï¼Œæä¾›ä¸“ä¸šçš„ç¾å­¦ç‚¹è¯„
- **å¯æ‰©å±•æ€§**ï¼šé‡‡ç”¨é€‚é…å™¨æ¨¡å¼ï¼Œæ”¯æŒå¿«é€Ÿæ¥å…¥æ–°çš„ç”ŸæˆæœåŠ¡å’Œè¯„åˆ†æ¨¡å—

### åº”ç”¨åœºæ™¯

- ç”µå•†è¥é”€å›¾æ™ºèƒ½ç”Ÿæˆä¸è¯„é€‰
- AIè‰ºæœ¯åˆ›ä½œè¾…åŠ©å·¥å…·
- å›¾åƒè´¨é‡è‡ªåŠ¨è¯„ä¼°ç³»ç»Ÿ
- å¤šæ¨¡å‹ç”Ÿæˆç»“æœå¯¹æ¯”æµ‹è¯•å¹³å°

---

## æ ¸å¿ƒç‰¹æ€§

### 1. å¤šæä¾›å•†å›¾åƒç”Ÿæˆ

æ”¯æŒçš„å›¾åƒç”ŸæˆæœåŠ¡ï¼š

| æä¾›å•† | æ ‡è¯†ç¬¦ | æ”¯æŒä»»åŠ¡ | è¯´æ˜ |
|--------|--------|----------|------|
| é€šä¹‰åƒé—® | `qwen` | text2image, image2image | é˜¿é‡Œäº‘DashScope APIï¼Œæ”¯æŒWanx 2.5æ¨¡å‹ |
| è±†åŒ…Seedream | `doubao_seedream` | text2image, image2image | å­—èŠ‚è·³åŠ¨è±†åŒ…AIï¼Œæ”¯æŒé¡ºåºç”Ÿæˆæ¨¡å¼ |
| OpenAI DALLÂ·E | `dalle` | text2image | OpenAIå®˜æ–¹å›¾åƒç”ŸæˆAPI |
| Gemini Flash | `gemini_flash` | text2image | Google Gemini 2.5 Flashæ¨¡å‹ |
| Pollinations | `pollinations` | text2image | å…è´¹Fluxæ¨¡å‹ï¼Œæ— éœ€APIå¯†é’¥ |
| HuggingFace | `huggingface` | text2image | HuggingFaceæ¨ç†API |
| Stability AI | `stability_free` | text2image | Stability AIå…è´¹å±‚ |
| Stable Diffusion | `stable_diffusion` | text2image | è‡ªæ‰˜ç®¡SDæ¨¡å‹ |
| Nano Banana | `nano_banana` | text2image | Nano BananaæœåŠ¡ |

### 2. è±†åŒ…å¤šç»´ç¾å­¦è¯„åˆ†ç³»ç»Ÿ

#### è¯„åˆ†ç»´åº¦ï¼ˆ1-10åˆ†åˆ¶ï¼‰

1. **æ„å›¾ï¼ˆcomposition â†’ contrast_scoreï¼‰**
   - è¯„ä¼°å›¾åƒçš„å¸ƒå±€ã€è§†è§‰ç„¦ç‚¹ã€æ¯”ä¾‹å’Œè°æ€§
   - è¯„åˆ¤ä¸»ä½“åœ¨ç”»é¢ä¸­çš„ä½ç½®æ˜¯å¦åˆç†

2. **å…‰å½±è‰²å½©ï¼ˆlight_color â†’ color_scoreï¼‰**
   - åˆ†æå…‰çº¿çš„ä½¿ç”¨ã€è‰²å½©æ­é…ã€æ˜æš—å¯¹æ¯”
   - è¯„ä¼°è‰²è°ƒçš„æƒ…ç»ªè¡¨è¾¾å’Œè§†è§‰å†²å‡»åŠ›

3. **é£æ ¼ä¸€è‡´æ€§ï¼ˆstyle_coherence â†’ noise_evalï¼‰**
   - æ£€æŸ¥ç”»é¢é£æ ¼æ˜¯å¦ç»Ÿä¸€åè°ƒ
   - è¯„ä¼°è‰ºæœ¯é£æ ¼çš„å®Œæ•´æ€§å’Œå†…åœ¨é€»è¾‘

4. **æƒ…æ„Ÿè¡¨è¾¾ï¼ˆemotional_impact â†’ quality_scoreï¼‰**
   - è¡¡é‡å›¾åƒä¼ é€’çš„æƒ…ç»ªå’Œæƒ…æ„Ÿå¼ºåº¦
   - è¯„åˆ¤å†…å®¹çš„æ„ŸæŸ“åŠ›å’Œå…±é¸£åº¦

5. **æ¸…æ™°å®Œæ•´åº¦ï¼ˆclarity_integrity â†’ clarity_evalï¼‰**
   - æ£€æµ‹å›¾åƒçš„æ¸…æ™°åº¦ã€å®Œæ•´æ€§
   - è¯†åˆ«æ¨¡ç³Šã€å¤±çœŸã€ç¼ºå¤±ç­‰é—®é¢˜

6. **ç»¼åˆç¾æ„Ÿï¼ˆfinal_score â†’ holisticï¼‰**
   - è®¡ç®—å…¬å¼ï¼š`0.75 Ã— ç¾å­¦ç»´åº¦å‡å€¼ + 0.25 Ã— æ¸…æ™°åº¦åˆ†`
   - ä½œä¸ºæœ€ç»ˆæ’åºä¾æ®

#### è¯„åˆ†æœºåˆ¶

- **ä¼˜å…ˆç­–ç•¥**ï¼šé¦–å…ˆè°ƒç”¨è±†åŒ…Vision APIè·å–ä¸“ä¸šè¯„åˆ†å’Œä¸­æ–‡ç‚¹è¯„
- **é™çº§ç­–ç•¥**ï¼šè‹¥è±†åŒ…APIå¤±è´¥ï¼Œè‡ªåŠ¨å›é€€åˆ°æŠ€æœ¯è¯„åˆ†æ¨¡å—ï¼ˆMNetç­‰ï¼‰
- **å½’ä¸€åŒ–**ï¼šæ‰€æœ‰åˆ†æ•°æ ‡å‡†åŒ–ä¸º0-1åŒºé—´ï¼ˆå‰ç«¯æ˜¾ç¤ºä¸º1-10åˆ†ï¼‰

### 3. æ™ºèƒ½ç®¡çº¿

#### æ–‡ç”Ÿå›¾æ™ºèƒ½ç®¡çº¿ï¼ˆText-to-Image Pipelineï¼‰

**å…¥å£ï¼š** `POST /v1/pipeline/text2image`

**æµç¨‹ï¼š**
```
ç”¨æˆ·è¾“å…¥Prompt
  â†“
[å¯é€‰] Promptæ‰©å†™
  â†“
å¤šæä¾›å•†å¹¶è¡Œç”Ÿæˆï¼ˆ1-4ä¸ªæä¾›å•†ï¼Œæ¯ä¸ª1-6å¼ å€™é€‰ï¼‰
  â†“
è±†åŒ…å¤šç»´ç¾å­¦è¯„åˆ†
  â†“
è‡ªåŠ¨é€‰æ‹©æœ€ä½³å€™é€‰
  â†“
è¿”å›ç»“æœï¼ˆæœ€ä½³å›¾+æ‰€æœ‰å€™é€‰+è¯„åˆ†+ç‚¹è¯„ï¼‰
```

**ç‰¹ç‚¹ï¼š**
- æ”¯æŒå¤šæ¨¡å‹å¹¶è¡Œè°ƒç”¨ï¼Œæé«˜æˆåŠŸç‡
- å®æ—¶è¿”å›è¯¦ç»†çš„è¯„åˆ†å’Œä¸“ä¸šç‚¹è¯„
- å‰ç«¯æ”¯æŒæ‰¹é‡ä¸‹è½½ã€å›¾ç‰‡é¢„è§ˆã€é›·è¾¾å›¾å±•ç¤º

#### å›¾ç”Ÿå›¾è¥é”€ç®¡çº¿ï¼ˆImage-to-Image Pipelineï¼‰

**å…¥å£ï¼š** `POST /v1/pipeline/image2image`

**æµç¨‹ï¼š**
```
ç”¨æˆ·ä¸Šä¼ å‚è€ƒå›¾ + è¥é”€éœ€æ±‚
  â†“
è±†åŒ…Visionåˆ†æå‚è€ƒå›¾ï¼ˆäº§å“ç±»åˆ«ã€é£æ ¼ã€å…³é”®è¯ï¼‰
  â†“
[å¯é€‰] æ£€ç´¢Promptæ¨¡æ¿åº“å¹¶èåˆ
  â†“
å¤šæä¾›å•†å¹¶è¡Œç”Ÿæˆ
  â†“
è±†åŒ…å¤šç»´ç¾å­¦è¯„åˆ†
  â†“
è±†åŒ…Visionä¸€è‡´æ€§æ£€æµ‹ï¼ˆå‚è€ƒå›¾vsç”Ÿæˆå›¾ï¼‰
  â†“
ç»¼åˆæ’åºï¼ˆç¾å­¦åˆ† + ä¸€è‡´æ€§åˆ†ï¼‰
  â†“
è¿”å›ç»“æœ + äº‹ä»¶æ—¥å¿—
```
**æ–°ç‰ˆæœ¬**
è¦æ±‚ä¸éœ€è¦promptæ¨¡æ¿åº“ï¼Œè€Œæ˜¯æŒ‡è¿›è¡Œä¸€è‡´æ€§æ£€æµ‹å’Œç»¼åˆæ’åº
**ç‰¹ç‚¹ï¼š**
- æ™ºèƒ½è¯†åˆ«å‚è€ƒå›¾çš„äº§å“å’Œé£æ ¼
- æä¾›è¥é”€æ¨¡æ¿æ”¯æŒï¼ˆclean/fresh/trendï¼‰
- ä¸€è‡´æ€§æ£€æµ‹ç¡®ä¿ç”Ÿæˆå›¾ä¸å‚è€ƒå›¾ä¸»ä½“ä¸€è‡´
- å®Œæ•´çš„äº‹ä»¶æ—¥å¿—è®°å½•ï¼ˆ`logs/doubao_events.jsonl`, `logs/pipeline_runs.jsonl`ï¼‰

---

## æŠ€æœ¯æ¶æ„

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å‰ç«¯åº”ç”¨å±‚                            â”‚
â”‚   React + TypeScript + Tailwind CSS + Framer Motion         â”‚
â”‚   åº”ç”¨å¹¿åœº | æ–‡ç”Ÿå›¾å·¥ä½œå° | å›¾ç”Ÿå›¾å·¥ä½œå° | ç¾å­¦ä½œå“å±•ç¤º      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ HTTP/JSON
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      APIç½‘å…³å±‚ï¼ˆGatewayï¼‰                     â”‚
â”‚                        FastAPI + Uvicorn                     â”‚
â”‚   /v1/aesthetic | /v1/pipeline/* | /api/apps | /api/works   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æœåŠ¡ç¼–æ’å±‚ï¼ˆOrchestratorï¼‰                 â”‚
â”‚              åè°ƒç”Ÿæˆã€è¯„åˆ†ã€å¢å¼ºã€é€‰ä¼˜å››å¤§æœåŠ¡                â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚            â”‚            â”‚            â”‚
     â†“            â†“            â†“            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”ŸæˆæœåŠ¡ â”‚ â”‚ è¯„åˆ†èšåˆå™¨â”‚ â”‚ å¢å¼ºæœåŠ¡ â”‚ â”‚ é€‰ä¼˜æœåŠ¡ â”‚
â”‚Generationâ”‚ â”‚  Scoring  â”‚ â”‚ Enhancer â”‚ â”‚ Selector â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚            â”‚
     â†“            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚13ä¸ªæä¾›å•† â”‚ â”‚ è±†åŒ…Visionè¯„åˆ†  â”‚
â”‚ é€‚é…å™¨    â”‚ â”‚ + æŠ€æœ¯è¯„åˆ†æ¨¡å—  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆ

#### åç«¯

- **æ¡†æ¶**ï¼šFastAPI 0.110+
- **æœåŠ¡å™¨**ï¼šUvicorn (ASGI)
- **HTTPå®¢æˆ·ç«¯**ï¼šhttpx (å¼‚æ­¥)
- **æ•°æ®éªŒè¯**ï¼šPydantic 2.6+
- **å›¾åƒå¤„ç†**ï¼šPillow 10.0+
- **AIé›†æˆ**ï¼šOpenAI SDK 1.12+
- **Pythonç‰ˆæœ¬**ï¼š3.10+

#### å‰ç«¯

- **æ¡†æ¶**ï¼šReact 19.1
- **è¯­è¨€**ï¼šTypeScript 5.9
- **æ„å»ºå·¥å…·**ï¼šVite 7.1
- **æ ·å¼**ï¼šTailwind CSS 3.4
- **åŠ¨ç”»**ï¼šFramer Motion 11.11
- **å›¾è¡¨**ï¼šRecharts 2.15
- **è·¯ç”±**ï¼šReact Router 7.0

#### å¼€å‘å·¥å…·

- **æµ‹è¯•**ï¼špytest, pytest-asyncio
- **ä»£ç æ£€æŸ¥**ï¼šruff (Python), ESLint (TypeScript)
- **å®¹å™¨åŒ–**ï¼šDocker, Docker Compose

---

## é¡¹ç›®ç»“æ„

### æ ¹ç›®å½•ç»“æ„

```
AestheticsEngine/
â”œâ”€â”€ gateway/                    # APIç½‘å…³å±‚ï¼ˆ712è¡Œï¼‰
â”‚   â”œâ”€â”€ main.py                # FastAPIä¸»åº”ç”¨ï¼ˆ182è¡Œï¼‰
â”‚   â”œâ”€â”€ orchestrator.py        # æœåŠ¡ç¼–æ’å™¨ï¼ˆ87è¡Œï¼‰
â”‚   â”œâ”€â”€ schemas.py             # è¯·æ±‚/å“åº”æ¨¡å‹ï¼ˆ41è¡Œï¼‰
â”‚   â””â”€â”€ data.py                # Mockæ•°æ®ï¼ˆ403è¡Œï¼‰
â”‚
â”œâ”€â”€ services/                  # æ ¸å¿ƒæœåŠ¡å±‚ï¼ˆ3,969è¡Œï¼‰
â”‚   â”œâ”€â”€ common/                # å…±äº«æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ models.py          # GeneratedImage, GenerationResult
â”‚   â”‚
â”‚   â”œâ”€â”€ generate/              # å›¾åƒç”ŸæˆæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ service.py         # ç»Ÿä¸€ç”Ÿæˆæ¥å£ï¼ˆ66è¡Œï¼‰
â”‚   â”‚   â”œâ”€â”€ models.py          # è¯·æ±‚è´Ÿè½½æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ __init__.py        # æä¾›å•†æ³¨å†Œè¡¨
â”‚   â”‚   â”œâ”€â”€ adapters/          # 13ä¸ªæä¾›å•†é€‚é…å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py        # åŸºç±»æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ qwen.py        # é€šä¹‰åƒé—®
â”‚   â”‚   â”‚   â”œâ”€â”€ doubao_seedream.py  # è±†åŒ…Seedream
â”‚   â”‚   â”‚   â”œâ”€â”€ dalle.py       # OpenAI DALLÂ·E
â”‚   â”‚   â”‚   â”œâ”€â”€ gemini_2_5.py  # Gemini Flash
â”‚   â”‚   â”‚   â”œâ”€â”€ pollinations.py  # Pollinationså…è´¹æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ huggingface.py
â”‚   â”‚   â”‚   â”œâ”€â”€ stability_free.py
â”‚   â”‚   â”‚   â”œâ”€â”€ stable_diffusion.py
â”‚   â”‚   â”‚   â””â”€â”€ nano_banana.py
â”‚   â”‚   â””â”€â”€ routes/
â”‚   â”‚       â”œâ”€â”€ providers.py   # æä¾›å•†ä¿¡æ¯è·¯ç”±
â”‚   â”‚       â””â”€â”€ provider_info.py
â”‚   â”‚
â”‚   â”œâ”€â”€ scoring/               # ç¾å­¦è¯„åˆ†èšåˆå™¨
â”‚   â”‚   â”œâ”€â”€ aggregator.py      # è¯„åˆ†èšåˆå™¨ï¼ˆ154è¡Œï¼‰
â”‚   â”‚   â”œâ”€â”€ base.py            # è¯„åˆ†æœåŠ¡åŸºç±»
â”‚   â”‚   â”œâ”€â”€ holistic/          # æ•´ä½“ç¾å­¦è¯„åˆ†
â”‚   â”‚   â”‚   â”œâ”€â”€ service.py     # MNetæœåŠ¡è°ƒç”¨ï¼ˆ161è¡Œï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ doubao_client.py  # è±†åŒ…Visionå®¢æˆ·ç«¯ï¼ˆ233è¡Œï¼‰
â”‚   â”‚   â”œâ”€â”€ color_score/       # è‰²å½©è¯„åˆ†
â”‚   â”‚   â”œâ”€â”€ contrast_score/    # å¯¹æ¯”åº¦è¯„åˆ†
â”‚   â”‚   â”œâ”€â”€ clarity_eval/      # æ¸…æ™°åº¦è¯„ä¼°
â”‚   â”‚   â”œâ”€â”€ noise_eval/        # å™ªå£°è¯„ä¼°
â”‚   â”‚   â””â”€â”€ quality_score/     # è´¨é‡è¯„åˆ†
â”‚   â”‚
â”‚   â”œâ”€â”€ pipeline/              # æ™ºèƒ½ç®¡çº¿
â”‚   â”‚   â”œâ”€â”€ text2image.py      # æ–‡ç”Ÿå›¾ç®¡çº¿ï¼ˆ323è¡Œï¼‰
â”‚   â”‚   â”œâ”€â”€ image2image.py     # å›¾ç”Ÿå›¾ç®¡çº¿ï¼ˆ881è¡Œï¼‰
â”‚   â”‚   â”œâ”€â”€ aesthetic_feedback.py  # ç¾å­¦åé¦ˆæ¨¡å—
â”‚   â”‚   â””â”€â”€ prompt_bank_cn.py  # ä¸­æ–‡æç¤ºè¯åº“
â”‚   â”‚
â”‚   â”œâ”€â”€ enhancer/              # å›¾åƒå¢å¼º
â”‚   â”‚   â””â”€â”€ service.py         # å¢å¼ºæœåŠ¡ï¼ˆé¢„ç•™ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ selector/              # æ™ºèƒ½é€‰ä¼˜
â”‚   â”‚   â””â”€â”€ service.py         # æœ€ä½³å€™é€‰é€‰æ‹©
â”‚   â”‚
â”‚   â””â”€â”€ proxy/                 # ä»£ç†æœåŠ¡
â”‚       â””â”€â”€ proxy_base.py      # HTTPä»£ç†è·¯ç”±å™¨
â”‚
â”œâ”€â”€ frontend/                  # Reactå‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.tsx           # åº”ç”¨å…¥å£
â”‚   â”‚   â”œâ”€â”€ App.tsx            # æ ¹ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ types.ts           # ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â””â”€â”€ api.ts         # APIå°è£…
â”‚   â”‚   â”œâ”€â”€ hooks/             # React Hooks
â”‚   â”‚   â”‚   â”œâ”€â”€ useAestheticTask.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ useImageCompose.ts
â”‚   â”‚   â”‚   â””â”€â”€ usePipeline.ts
â”‚   â”‚   â”œâ”€â”€ components/        # UIç»„ä»¶ï¼ˆ24+ä¸ªï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ ui/            # åŸºç¡€ç»„ä»¶ï¼ˆButton, Card, Badgeç­‰ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ core/          # æ ¸å¿ƒç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ AestheticWorkspace.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ TextToImageWorkspace.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ImageComposeWorkspace.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ScoreRadarChart.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ pages/             # é¡µé¢è·¯ç”±
â”‚   â”‚       â”œâ”€â”€ ai-application.tsx     # åº”ç”¨å¹¿åœº
â”‚   â”‚       â”œâ”€â”€ ai-detail/[id].tsx     # ä»»åŠ¡æ§åˆ¶å°
â”‚   â”‚       â”œâ”€â”€ generate.tsx           # æ–‡ç”Ÿå›¾æ™ºèƒ½ç®¡çº¿
â”‚   â”‚       â”œâ”€â”€ image-compose.tsx      # å›¾ç”Ÿå›¾è¥é”€å›¾
â”‚   â”‚       â””â”€â”€ aesthetic-workspace.tsx # ç¾å­¦å·¥ä½œå°
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â””â”€â”€ tsconfig.json
â”‚
â”œâ”€â”€ config/                    # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ config.yaml            # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ default.py             # é»˜è®¤é…ç½®
â”‚
â”œâ”€â”€ prompts/                   # AIæç¤ºè¯æ¨¡æ¿
â”‚   â””â”€â”€ doubao_aesthetic.prompt  # è±†åŒ…ç¾å­¦è¯„åˆ†æç¤ºè¯
â”‚
â”œâ”€â”€ doc/                       # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ README.zh.md           # ä¸­æ–‡è¯¦ç»†æ–‡æ¡£
â”‚   â”œâ”€â”€ PROJECT_NOTES.md       # é¡¹ç›®ç¬”è®°
â”‚   â””â”€â”€ é¡¹ç›®å®Œæ•´æ–‡æ¡£.md         # æœ¬æ–‡æ¡£
â”‚
â”œâ”€â”€ infra/                     # åŸºç¡€è®¾æ–½
â”‚   â”œâ”€â”€ docker-compose.yml     # Dockerç¼–æ’
â”‚   â””â”€â”€ dockerfiles/
â”‚       â””â”€â”€ gateway.Dockerfile
â”‚
â”œâ”€â”€ tests/                     # æµ‹è¯•ä»£ç 
â”‚   â”œâ”€â”€ test_pipeline_endpoint.py
â”‚   â”œâ”€â”€ test_generate_endpoint.py
â”‚   â”œâ”€â”€ test_image2image_pipeline.py
â”‚   â””â”€â”€ Qwen_test.py
â”‚
â”œâ”€â”€ logs/                      # è¿è¡Œæ—¥å¿—
â”‚   â”œâ”€â”€ doubao_events.jsonl    # è±†åŒ…APIè°ƒç”¨æ—¥å¿—
â”‚   â””â”€â”€ pipeline_runs.jsonl    # ç®¡çº¿è¿è¡Œæ—¥å¿—
â”‚
â”œâ”€â”€ pyproject.toml             # Pythoné¡¹ç›®é…ç½®
â”œâ”€â”€ README.md                  # é¡¹ç›®è¯´æ˜ï¼ˆè‹±æ–‡ï¼‰
â”œâ”€â”€ CONTRIBUTING.md            # è´¡çŒ®æŒ‡å—
â””â”€â”€ openapi.yaml               # OpenAPIè§„èŒƒ

```

### ä»£ç ç»Ÿè®¡

- **Pythonæ–‡ä»¶**ï¼šçº¦70ä¸ªï¼Œå…±è®¡4,681è¡Œä»£ç 
- **TypeScript/TSXæ–‡ä»¶**ï¼š44ä¸ªå‰ç«¯æ–‡ä»¶
- **æ”¯æŒæä¾›å•†**ï¼š13ä¸ªå›¾åƒç”Ÿæˆé€‚é…å™¨
- **è¯„åˆ†ç»´åº¦**ï¼š6ä¸ªï¼ˆ5ä¸ªç¾å­¦ + 1ä¸ªç»¼åˆï¼‰

---

## æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 1. Gatewayï¼ˆAPIç½‘å…³ï¼‰

**ä½ç½®ï¼š** `gateway/main.py`

**èŒè´£ï¼š**
- å¯¹å¤–æš´éœ²ç»Ÿä¸€çš„RESTful APIæ¥å£
- å¤„ç†CORSè·¨åŸŸè¯·æ±‚
- ä¾èµ–æ³¨å…¥å’ŒæœåŠ¡ç¼–æ’
- æä¾›Mockæ•°æ®ä¾›å‰ç«¯è”è°ƒ

**ä¸»è¦ç«¯ç‚¹ï¼š**

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/v1/aesthetic` | POST | æ ‡å‡†ç”Ÿæˆ+è¯„åˆ†+å¢å¼ºæ¥å£ |
| `/v1/pipeline/text2image` | POST | æ–‡ç”Ÿå›¾æ™ºèƒ½ç®¡çº¿ |
| `/v1/pipeline/image2image` | POST | å›¾ç”Ÿå›¾è¥é”€ç®¡çº¿ |
| `/api/apps` | GET | åº”ç”¨åˆ—è¡¨ |
| `/api/apps/{id}` | GET | åº”ç”¨è¯¦æƒ… |
| `/api/works` | GET | ä½œå“åˆ—è¡¨ |
| `/api/mock/gallery` | GET | ä½œå“å›¾åº“ï¼ˆåˆ†é¡µï¼‰ |
| `/api/user/{id}` | GET | ç”¨æˆ·ä¿¡æ¯ |
| `/v1/publish` | POST | å‘å¸ƒä½œå“ï¼ˆå ä½ï¼‰ |
| `/api/providers` | GET | ç”ŸæˆæœåŠ¡æä¾›å•†åˆ—è¡¨ |

**å…³é”®ä»£ç ç‰‡æ®µï¼š**

```python
# æœåŠ¡ç¼–æ’å™¨ä¾èµ–æ³¨å…¥
def get_orchestrator() -> ServiceOrchestrator:
    generation_service = GenerationService()
    scoring_aggregator = ScoringAggregator()
    enhancer = EnhancementService()
    selector = SelectorService()
    return ServiceOrchestrator(
        generation_service=generation_service,
        scoring_aggregator=scoring_aggregator,
        enhancer=enhancer,
        selector=selector,
    )

# æ ‡å‡†ç¾å­¦æ¥å£
@app.post("/v1/aesthetic", response_model=GenerateResponse)
async def generate_endpoint(
    payload: GenerateRequest,
    orchestrator: ServiceOrchestrator = Depends(get_orchestrator),
) -> GenerateResponse:
    return await orchestrator.handle_generate(payload)
```

### 2. ServiceOrchestratorï¼ˆæœåŠ¡ç¼–æ’å™¨ï¼‰

**ä½ç½®ï¼š** `gateway/orchestrator.py`

**èŒè´£ï¼š**
- åè°ƒç”Ÿæˆã€è¯„åˆ†ã€å¢å¼ºã€é€‰ä¼˜å››å¤§æœåŠ¡
- æ‰§è¡Œå®Œæ•´çš„ç¾å­¦å¼•æ“å·¥ä½œæµ
- å¤„ç†å¼‚å¸¸å’Œé™çº§é€»è¾‘

**å·¥ä½œæµç¨‹ï¼š**

```python
async def handle_generate(self, payload: GenerateRequest) -> GenerateResponse:
    # 1. ç”Ÿæˆå›¾ç‰‡
    generation_result = await self._generation_service.generate(
        task_id=task_id, request=payload
    )

    # 2. å¯é€‰å¢å¼º
    if payload.enhancement.apply_clarity:
        processed_images = await self._enhancer.apply_clarity(
            task_id=task_id, images=generation_result.images
        )

    # 3. ç¾å­¦è¯„åˆ†
    if processed_images and payload.use_modules:
        scoring_summary = await self._scoring_aggregator.score_candidates(
            task_id=task_id,
            images=processed_images,
            modules=payload.use_modules,
        )

    # 4. é€‰æ‹©æœ€ä½³
    selection = await self._selector.select_best(
        task_id=task_id,
        candidates=processed_images,
        evaluations=scoring_summary.image_results if scoring_summary else None,
    )

    return GenerateResponse(...)
```

### 3. GenerationServiceï¼ˆç”ŸæˆæœåŠ¡ï¼‰

**ä½ç½®ï¼š** `services/generate/service.py`

**èŒè´£ï¼š**
- æä¾›ç»Ÿä¸€çš„å›¾åƒç”Ÿæˆæ¥å£
- å±è”½ä¸åŒæä¾›å•†çš„APIå·®å¼‚
- æ ‡å‡†åŒ–è¿”å›ç»“æœ

**æä¾›å•†é€‚é…å™¨æ¥å£ï¼š**

```python
# åŸºç±»æ¥å£ï¼ˆservices/generate/adapters/base.pyï¼‰
class BaseProvider(ABC):
    @property
    @abstractmethod
    def name(self) -> str:
        """æä¾›å•†æ ‡è¯†ç¬¦"""
        pass

    @abstractmethod
    async def generate(self, request: GenerateRequestPayload) -> Dict[str, Any]:
        """ç”Ÿæˆå›¾åƒï¼Œè¿”å›æ ‡å‡†æ ¼å¼"""
        pass
```

**æ”¯æŒçš„ä»»åŠ¡ç±»å‹ï¼š**
- `text2image`ï¼šæ–‡æœ¬ç”Ÿæˆå›¾åƒ
- `image2image`ï¼šå›¾åƒè½¬å›¾åƒ

**æä¾›å•†æ³¨å†Œè¡¨ï¼ˆ`services/generate/__init__.py`ï¼‰ï¼š**

```python
from services.generate.adapters.qwen import QwenAdapter
from services.generate.adapters.doubao_seedream import DoubaoSeedreamAdapter
from services.generate.adapters.dalle import DalleAdapter
# ... å…¶ä»–é€‚é…å™¨

_PROVIDERS = {
    "qwen": QwenAdapter(),
    "doubao_seedream": DoubaoSeedreamAdapter(),
    "dalle": DalleAdapter(),
    "gemini_flash": GeminiFlashAdapter(),
    "pollinations": PollinationsAdapter(),
    # ...
}

def get_provider(name: str) -> BaseProvider:
    provider = _PROVIDERS.get(name)
    if not provider:
        raise ValueError(f"Unknown provider: {name}")
    return provider
```

### 4. ScoringAggregatorï¼ˆè¯„åˆ†èšåˆå™¨ï¼‰

**ä½ç½®ï¼š** `services/scoring/aggregator.py`

**èŒè´£ï¼š**
- èšåˆå¤šä¸ªè¯„åˆ†æ¨¡å—çš„ç»“æœ
- ä¼˜å…ˆè°ƒç”¨è±†åŒ…Vision API
- å¤±è´¥æ—¶é™çº§åˆ°æŠ€æœ¯è¯„åˆ†æ¨¡å—
- è®¡ç®—ç»¼åˆåˆ†æ•°

**è¯„åˆ†æµç¨‹ï¼š**

```python
async def score_candidates(
    self,
    *,
    task_id: UUID,
    images: Iterable[GeneratedImage],
    modules: Sequence[str],
) -> AggregationResult:
    services = self._select_services(modules)
    result: Dict[str, ImageEvaluation] = {}

    for image in images:
        # 1. å°è¯•è±†åŒ…è¯„åˆ†
        doubao_result = await self._fetch_doubao_scores(image=image)

        # 2. æ”¶é›†è±†åŒ…è¿”å›çš„åˆ†æ•°å’Œç‚¹è¯„
        if doubao_result:
            module_scores.update(doubao_result.scores)
            module_comments.update(doubao_result.comments)

        # 3. å¯¹äºç¼ºå¤±çš„æ¨¡å—ï¼Œè°ƒç”¨æŠ€æœ¯è¯„åˆ†
        for service in services:
            if service.module_name not in module_scores:
                score = await service.score(task_id=task_id, image=image)
                module_scores[service.module_name] = score

        # 4. ç”Ÿæˆè¯„ä¼°ç»“æœ
        result[image.url] = ImageEvaluation(
            module_scores=module_scores,
            composite_score=self._primary_score(module_scores),
            module_comments=module_comments if module_comments else None,
        )

    return AggregationResult(...)
```

**ç»¼åˆåˆ†æ•°è®¡ç®—ï¼š**

```python
def _primary_score(self, module_scores: Dict[str, float]) -> float:
    """ä½¿ç”¨holisticåˆ†æ•°ä½œä¸ºç»¼åˆåˆ†"""
    value = module_scores.get("holistic")
    if value is None:
        return 0.0
    return float(value)
```

### 5. DoubaoAestheticClientï¼ˆè±†åŒ…ç¾å­¦å®¢æˆ·ç«¯ï¼‰

**ä½ç½®ï¼š** `services/scoring/holistic/doubao_client.py`

**èŒè´£ï¼š**
- è°ƒç”¨è±†åŒ…Vision APIè¿›è¡Œå›¾åƒç¾å­¦è¯„ä¼°
- è§£æè¿”å›çš„JSONç»“æœ
- æ˜ å°„5ä¸ªç»´åº¦åˆ†æ•°åˆ°ç³»ç»Ÿå†…éƒ¨åç§°

**é…ç½®å‚æ•°ï¼š**

```python
def __init__(self, ...):
    self._api_url = os.getenv("DOUBAO_VISION_URL") or "https://ark.cn-beijing.volces.com/api/v3/chat/completions"
    self._model = os.getenv("HOLISTIC_MODEL") or "doubao-seed-1-6-vision"
    self._api_key = os.getenv("ARK_API_KEY") or os.getenv("DOUBAO_API_KEY")
    self._system_prompt = self._load_prompt("prompts/doubao_aesthetic.prompt")
```

**è¯„åˆ†è¯·æ±‚æ ¼å¼ï¼š**

```python
payload = {
    "model": "doubao-seed-1-6-vision",
    "input": [
        {"role": "system", "content": system_prompt},
        {
            "role": "user",
            "content": [
                {"type": "image_url", "image_url": image_url},
                {"type": "text", "text": "è¯·ç›´æ¥è¾“å‡ºJSONç»“æœ"}
            ]
        }
    ],
    "response_format": {"type": "json_object"},
    "tools": ["image_process"]
}
```

**è¯„åˆ†ç»´åº¦æ˜ å°„ï¼š**

```python
mapping = {
    "light_color": "color_score",          # å…‰å½±è‰²å½©
    "composition": "contrast_score",       # æ„å›¾
    "clarity_integrity": "clarity_eval",   # æ¸…æ™°å®Œæ•´åº¦
    "style_coherence": "noise_eval",       # é£æ ¼ä¸€è‡´æ€§
    "emotional_impact": "quality_score",   # æƒ…æ„Ÿè¡¨è¾¾
}
```

**åˆ†æ•°å½’ä¸€åŒ–ï¼š**

```python
@staticmethod
def _normalize_score(value: Any) -> Optional[float]:
    """å°†1-10åˆ†åˆ¶è½¬æ¢ä¸º0-1åŒºé—´"""
    numeric = float(value)
    if numeric > 10:
        return 1.0
    return round(max(0.0, min(numeric / 10.0, 1.0)), 3)
```

### 6. Text2ImagePipelineï¼ˆæ–‡ç”Ÿå›¾ç®¡çº¿ï¼‰

**ä½ç½®ï¼š** `services/pipeline/text2image.py`

**èŒè´£ï¼š**
- ç¼–æ’å®Œæ•´çš„æ–‡ç”Ÿå›¾å·¥ä½œæµ
- æ”¯æŒå¤šæä¾›å•†å¹¶è¡Œç”Ÿæˆ
- è¿”å›ç»“æ„åŒ–ç»“æœä¾›å‰ç«¯å±•ç¤º

**è¯·æ±‚æ¨¡å‹ï¼š**

```python
class Text2ImagePipelineRequest(BaseModel):
    prompt: str                                    # ç”¨æˆ·æç¤ºè¯
    providers: List[str]                          # æä¾›å•†åˆ—è¡¨ï¼ˆ1-4ä¸ªï¼‰
    num_candidates: int = Field(default=3, ge=1, le=6)  # æ¯ä¸ªæä¾›å•†ç”Ÿæˆæ•°é‡
    params: PipelineParams = Field(default_factory=PipelineParams)

class PipelineParams(BaseModel):
    ratio: str = Field(default="1:1")             # å®½é«˜æ¯”
    expand_prompt: bool = Field(default=False)    # æ˜¯å¦æ‰©å†™Prompt
    modules: Optional[List[str]] = None           # è¯„åˆ†æ¨¡å—
```

**æ ¸å¿ƒæµç¨‹ï¼š**

```python
async def run_text2image_pipeline(payload: Text2ImagePipelineRequest) -> Dict[str, Any]:
    # 1. å¯é€‰Promptæ‰©å†™
    applied_prompt, expansion_suffix = await _maybe_expand_prompt(
        prompt=payload.prompt,
        enable=payload.params.expand_prompt,
    )

    # 2. å¤šæä¾›å•†å¹¶è¡Œç”Ÿæˆ
    candidates = await _generate_candidates(
        provider_names=payload.providers,
        prompt=applied_prompt,
        size=_ratio_to_size(payload.params.ratio),
        num_candidates=payload.num_candidates,
    )

    # 3. ç¾å­¦è¯„åˆ†
    aggregation = await _evaluate_candidates(
        task_id=task_id,
        images=candidates,
        modules=payload.params.modules or DEFAULT_MODULES,
    )

    # 4. é€‰æ‹©æœ€ä½³
    selection = await _select_best(
        task_id=task_id,
        candidates=candidates,
        aggregation=aggregation,
    )

    # 5. æ„å»ºå“åº”
    return {
        "status": "success",
        "task_id": str(task_id),
        "best_image_url": best_image.url,
        "best_composite_score": best_evaluation.composite_score,
        "candidates": _serialize_candidates(candidates, aggregation),
        "summary": _build_summary(best_evaluation),  # ä¸­æ–‡ç‚¹è¯„
        "providers_used": sorted({image.provider for image in candidates}),
    }
```

**ç‚¹è¯„æ–‡æœ¬ç”Ÿæˆï¼š**

```python
def _build_summary(evaluation) -> str:
    """æ ¹æ®è±†åŒ…è¿”å›çš„ç‚¹è¯„æ„å»ºä¸­æ–‡æ‘˜è¦"""
    comments = getattr(evaluation, "module_comments", None) or {}
    if comments:
        summary_parts: List[str] = []
        for key in ["contrast_score", "color_score", "clarity_eval", "quality_score", "noise_eval"]:
            comment = comments.get(key)
            if comment:
                label = LABEL_MAP_FOR_SUMMARY.get(key, key)  # æ„å›¾è¡¨è¾¾ã€å…‰è‰²è¡¨ç°ç­‰
                summary_parts.append(f"{label}ï¼š{comment}")

        holistic = evaluation.module_scores.get("holistic")
        if holistic is not None:
            summary_parts.append(f"ç»¼åˆç¾æ„Ÿå¾—åˆ†çº¦ä¸º {(holistic * 10):.1f}ã€‚")

        return "ï¼›".join(summary_parts)

    return "è¯¥å›¾ç‰‡åœ¨å¤šä¸ªç»´åº¦è¡¨ç°å‡è¡¡ã€‚"
```

### 7. Image2ImagePipelineï¼ˆå›¾ç”Ÿå›¾ç®¡çº¿ï¼‰

**ä½ç½®ï¼š** `services/pipeline/image2image.py`

**èŒè´£ï¼š**
- ç¼–æ’å›¾ç”Ÿå›¾è¥é”€ç®¡çº¿
- è°ƒç”¨è±†åŒ…Visionåˆ†æå‚è€ƒå›¾
- æ£€ç´¢Promptæ¨¡æ¿åº“
- è¿›è¡Œä¸»ä½“ä¸€è‡´æ€§æ£€æµ‹
- è®°å½•å®Œæ•´çš„äº‹ä»¶æ—¥å¿—

**è¯·æ±‚æ¨¡å‹ï¼š**

```python
class Image2ImagePipelineRequest(BaseModel):
    prompt: str                                   # ç”¨æˆ·æç¤ºè¯
    reference_images: List[str]                   # å‚è€ƒå›¾ï¼ˆURLæˆ–base64ï¼‰
    providers: List[str]                          # æä¾›å•†åˆ—è¡¨
    size: str = Field(default="1024x1024")        # è¾“å‡ºå°ºå¯¸
    params: Image2ImagePipelineParams = Field(default_factory=...)

class Image2ImagePipelineParams(BaseModel):
    modules: Optional[List[str]] = None           # è¯„åˆ†æ¨¡å—
    num_variations: int = Field(default=1, ge=1, le=3)  # å˜ä½“æ•°é‡
    platform: Optional[str] = None                # ç”µå•†å¹³å°ï¼ˆæ·˜å®/äº¬ä¸œç­‰ï¼‰
    product: Optional[str] = None                 # äº§å“ç±»åˆ«
    style: Optional[str] = None                   # é£æ ¼ï¼ˆæ¸…æ–°/è´¨æ„Ÿ/æ½®æµï¼‰
    use_prompt_bank: bool = True                  # æ˜¯å¦ä½¿ç”¨Promptåº“
```

**æ ¸å¿ƒæµç¨‹ï¼š**

```python
async def run_image2image_pipeline(payload: Image2ImagePipelineRequest) -> Dict[str, Any]:
    # 1. åˆ†æå‚è€ƒå›¾
    analysis = await _analyze_reference_images(
        reference_images=payload.reference_images,
        platform_hint=params.platform,
        product_hint=params.product,
        style_hint=params.style,
    )
    # è¿”å›ï¼š{"embedding": [...], "platform": "æ·˜å®", "product": "åŒ–å¦†å“",
    #       "style": "è´¨æ„Ÿå•†ä¸šé£", "keywords": [...], "description": "..."}

    # 2. Promptæ¨¡æ¿èåˆ
    if prompt_bank_enabled:
        prompt_bank = _get_prompt_bank()
        template = prompt_bank.retrieve(
            analysis.get("embedding"),
            platform=analysis.get("platform"),
            description=analysis.get("description"),
        )
        fused = prompt_bank.fuse(template, analysis)
        final_prompt = _merge_prompts(payload.prompt, fused)

    # 3. å¤šæä¾›å•†ç”Ÿæˆ
    all_candidates = await _generate_candidates(
        task_id=task_id,
        prompt=final_prompt,
        providers=payload.providers,
        num_variations=params.num_variations,
        reference_images=payload.reference_images,
        modules=modules,
        size=size,
    )

    # 4. ä¸€è‡´æ€§æ£€æµ‹ï¼ˆæ¯ä¸ªå€™é€‰å›¾ä¸å‚è€ƒå›¾æ¯”è¾ƒï¼‰
    verification = await _verify_consistency(
        task_id=task_id,
        reference_images=reference_images,
        generated_images=generated_images,
    )
    # è¿”å›ï¼š{"image_url": {"status": "scored", "score": 0.85}}

    # 5. é€‰æ‹©æœ€ä½³ï¼ˆç»¼åˆç¾å­¦åˆ†å’Œä¸€è‡´æ€§åˆ†ï¼‰
    best = _select_best_image(all_candidates)

    # 6. ç¾å­¦åé¦ˆï¼ˆæ›´æ–°æ¨¡æ¿æƒé‡ï¼‰
    if prompt_bank_enabled and template_id:
        feedback_module = _get_feedback_module()
        updated_weight = feedback_module.alpha * template_weight + (1 - feedback_module.alpha) * feedback_score
        prompt_bank.update_weight(template_id, updated_weight)

    # 7. è®°å½•äº‹ä»¶æ—¥å¿—
    _record_pipeline_event("pipeline_summary", {...})

    return {...}
```

**å‚è€ƒå›¾åˆ†æPromptï¼š**

```python
def _build_analysis_prompt(...) -> str:
    return (
        "ä½ æ˜¯ç”µå•†è§†è§‰åˆ†æåŠ©æ‰‹ï¼Œè¯·åŸºäºä¸Šä¼ çš„äº§å“å›¾ç”Ÿæˆç®€æ´çš„ JSON è¾“å‡ºï¼Œä¸¥ç¦è¾“å‡ºé™¤ JSON ä»¥å¤–çš„æ–‡å­—ã€‚\n"
        "éœ€è¦åŒ…å«å­—æ®µï¼š\n"
        '  "product": ä¸»è¦å•†å“ç±»åˆ«ï¼Œé»˜è®¤"äº§å“"ã€‚\n'
        '  "style": æ¦‚è¿°æ•´ä½“é£æ ¼ï¼Œå¦‚å¸ƒå…‰/èƒŒæ™¯/æƒ…ç»ªï¼Œé»˜è®¤"ç”µå•†å¸¸ç”¨å¸ƒå…‰"ã€‚\n'
        '  "style_keywords": åŒ…å« 3-5 ä¸ªåœºæ™¯/å…‰çº¿/æè´¨å…³é”®è¯çš„æ•°ç»„ã€‚\n'
        '  "platform": æ¨èæœ€é€‚åˆçš„ç”µå•†å¹³å°ï¼Œè‹¥ä¸ç¡®å®šå¯è¿”å›"æ·˜å®"ã€‚\n'
        '  "description": ä¸€å¥è¯ä¸­æ–‡è¯­ä¹‰æè¿°ï¼Œ30 å­—ä»¥å†…ã€‚\n'
        "ä»…è¾“å‡º JSON å¯¹è±¡ã€‚"
    )
```

**ä¸€è‡´æ€§æ£€æµ‹Promptï¼š**

```python
def _build_consistency_prompt(reference_images, candidate_image) -> str:
    count = len(reference_images)
    return (
        "ä½ æ˜¯ç”µå•†å•†å“ä¸€è‡´æ€§å®¡æ ¸åŠ©æ‰‹ã€‚è¯·æ¯”è¾ƒå€™é€‰å›¾ç‰‡ä¸å‚è€ƒå›¾ç‰‡çš„ä¸»ä½“æ˜¯å¦ä¸€è‡´ï¼Œ"
        f"å‚è€ƒå›¾ç‰‡æ•°é‡çº¦ä¸º {count}ï¼Œå€™é€‰å›¾éœ€ä¿æŒåŒç±»å•†å“ã€ä¸»è‰²è°ƒä¸å…³é”®ç‰¹å¾ã€‚"
        "è¯·è¾“å‡º JSONï¼Œå­—æ®µï¼šscoreï¼ˆ0-1 æµ®ç‚¹ï¼Œ1 è¡¨ç¤ºå®Œå…¨ä¸€è‡´ï¼‰ã€commentï¼ˆä¸­æ–‡è§£é‡Šï¼Œä¸è¶…è¿‡30å­—ï¼‰ã€‚"
        "ä»…è¿”å› JSONã€‚"
    )
```

**äº‹ä»¶æ—¥å¿—è®°å½•ï¼š**

æ—¥å¿—æ–‡ä»¶ä¿å­˜åœ¨ `logs/` ç›®å½•ï¼š
- `doubao_events.jsonl`ï¼šè®°å½•æ‰€æœ‰è±†åŒ…APIè°ƒç”¨å’Œå“åº”
- `pipeline_runs.jsonl`ï¼šè®°å½•ç®¡çº¿è¿è¡Œçš„å®Œæ•´è¿‡ç¨‹

æ—¥å¿—æ ¼å¼ï¼š
```json
{
  "ts": "2025-11-05T10:30:45Z",
  "event": "pipeline_summary",
  "data": {
    "task_id": "uuid",
    "providers": ["qwen", "doubao_seedream"],
    "best": {
      "provider": "qwen",
      "url": "https://...",
      "aesthetic_score": 0.87
    },
    "results": [...]
  }
}
```

---

## APIæ¥å£æ–‡æ¡£

### 1. æ ‡å‡†ç¾å­¦æ¥å£

**ç«¯ç‚¹ï¼š** `POST /v1/aesthetic`

**è¯´æ˜ï¼š** ç”Ÿæˆå›¾åƒ â†’ å¢å¼º â†’ è¯„åˆ† â†’ é€‰ä¼˜çš„å®Œæ•´æµç¨‹

**è¯·æ±‚ä½“ï¼š**

```json
{
  "task": "text2image",
  "prompt": "ä¸€åªçŒ«éª‘ç€è‡ªè¡Œè½¦",
  "provider": "qwen",
  "size": "1024x1024",
  "use_modules": ["holistic", "color_score", "contrast_score", "clarity_eval"],
  "params": {
    "cfg_scale": 7.5,
    "steps": 50
  },
  "enhancement": {
    "apply_clarity": true
  }
}
```

**å“åº”ï¼š**

```json
{
  "status": "success",
  "task_id": "123e4567-e89b-12d3-a456-426614174000",
  "image_url": "https://cdn.example.com/output.png",
  "modules_used": ["holistic", "color_score", "contrast_score", "clarity_eval"],
  "scores": {
    "holistic": 0.85
  },
  "composite_score": 0.85,
  "best_candidate": "https://cdn.example.com/output.png"
}
```

### 2. æ–‡ç”Ÿå›¾æ™ºèƒ½ç®¡çº¿

**ç«¯ç‚¹ï¼š** `POST /v1/pipeline/text2image`

**è¯´æ˜ï¼š** å¤šæ¨¡å‹å¹¶è¡Œç”Ÿæˆ + è±†åŒ…è¯„åˆ† + ä¸“ä¸šç‚¹è¯„

**è¯·æ±‚ä½“ï¼š**

```json
{
  "prompt": "ä¸€åªçŒ«éª‘ç€è‡ªè¡Œè½¦ï¼Œæ¢µé«˜é£æ ¼",
  "providers": ["qwen", "doubao_seedream", "pollinations"],
  "num_candidates": 2,
  "params": {
    "ratio": "16:9",
    "expand_prompt": false,
    "modules": ["holistic", "color_score", "contrast_score", "clarity_eval", "noise_eval", "quality_score"]
  }
}
```

**å“åº”ï¼š**

```json
{
  "status": "success",
  "task_id": "123e4567-e89b-12d3-a456-426614174000",
  "best_image_url": "https://cdn.example.com/best.png",
  "best_composite_score": 0.87,
  "candidates": [
    {
      "image_url": "https://cdn.example.com/img1.png",
      "provider": "qwen",
      "scores": {
        "color_score": 0.85,
        "contrast_score": 0.82,
        "clarity_eval": 0.90,
        "noise_eval": 0.88,
        "quality_score": 0.86
      },
      "composite_score": 0.87
    },
    {
      "image_url": "https://cdn.example.com/img2.png",
      "provider": "doubao_seedream",
      "scores": {
        "color_score": 0.78,
        "contrast_score": 0.80,
        "clarity_eval": 0.85,
        "noise_eval": 0.82,
        "quality_score": 0.79
      },
      "composite_score": 0.81
    }
  ],
  "summary": "æ„å›¾è¡¨è¾¾ï¼šä¸»ä½“å±…ä¸­ï¼Œè§†è§‰ç„¦ç‚¹çªå‡ºï¼›å…‰è‰²è¡¨ç°ï¼šè‰²å½©é²œè‰³ï¼Œæ˜æš—å±‚æ¬¡åˆ†æ˜ï¼›æ¸…æ™°å®Œæ•´åº¦ï¼šå›¾åƒæ¸…æ™°ï¼Œç»†èŠ‚ä¿ç•™å®Œæ•´ï¼›æƒ…ç»ªæ„ŸæŸ“åŠ›ï¼šæƒ…æ„Ÿè¡¨è¾¾è‡ªç„¶ï¼Œå¯Œæœ‰æ„ŸæŸ“åŠ›ï¼›é£æ ¼åè°ƒæ€§ï¼šæ¢µé«˜é£æ ¼å‘ˆç°å®Œæ•´ï¼›ç»¼åˆç¾æ„Ÿå¾—åˆ†çº¦ä¸º 8.7ã€‚",
  "prompt": {
    "original": "ä¸€åªçŒ«éª‘ç€è‡ªè¡Œè½¦ï¼Œæ¢µé«˜é£æ ¼",
    "applied": "ä¸€åªçŒ«éª‘ç€è‡ªè¡Œè½¦ï¼Œæ¢µé«˜é£æ ¼",
    "expanded": null,
    "expansion_suffix": null
  },
  "providers_used": ["qwen", "doubao_seedream", "pollinations"]
}
```

### 3. å›¾ç”Ÿå›¾è¥é”€ç®¡çº¿

**ç«¯ç‚¹ï¼š** `POST /v1/pipeline/image2image`

**è¯´æ˜ï¼š** å‚è€ƒå›¾åˆ†æ + Promptèåˆ + ç”Ÿæˆ + ä¸€è‡´æ€§æ£€æµ‹

**è¯·æ±‚ä½“ï¼š**

```json
{
  "prompt": "æ¸…æ–°è‡ªç„¶çš„äº§å“å±•ç¤º",
  "reference_images": [
    "https://example.com/ref1.jpg",
    "data:image/jpeg;base64,/9j/4AAQSkZJRg..."
  ],
  "providers": ["qwen", "doubao_seedream"],
  "size": "1024x1024",
  "params": {
    "modules": ["holistic", "color_score", "contrast_score", "clarity_eval", "noise_eval", "quality_score"],
    "num_variations": 2,
    "platform": "æ·˜å®",
    "product": "åŒ–å¦†å“",
    "style": "æ¸…æ–°",
    "use_prompt_bank": true
  }
}
```

**å“åº”ï¼š**

```json
{
  "status": "success",
  "task_id": "123e4567-e89b-12d3-a456-426614174000",
  "best_image_url": "https://cdn.example.com/best.png",
  "best_provider": "qwen",
  "results": [
    {
      "provider": "qwen",
      "image_url": "https://cdn.example.com/img1.png",
      "scores": {
        "color_score": 0.88,
        "contrast_score": 0.85,
        "clarity_eval": 0.92,
        "noise_eval": 0.87,
        "quality_score": 0.89
      },
      "composite_score": 0.88,
      "verification": {
        "status": "scored",
        "score": 0.92
      }
    },
    {
      "provider": "doubao_seedream",
      "image_url": "https://cdn.example.com/img2.png",
      "scores": {
        "color_score": 0.82,
        "contrast_score": 0.80,
        "clarity_eval": 0.86,
        "noise_eval": 0.83,
        "quality_score": 0.81
      },
      "composite_score": 0.82,
      "verification": {
        "status": "scored",
        "score": 0.85
      }
    }
  ],
  "reference_images": ["https://example.com/ref1.jpg", "data:image/jpeg;base64,..."],
  "image_size": "1024x1024",
  "providers_used": ["qwen", "doubao_seedream"],
  "final_prompt": "æ¸…æ–°è‡ªç„¶çš„äº§å“å±•ç¤ºï¼›æ·¡é›…èƒŒæ™¯ï¼ŒæŸ”å’Œå…‰çº¿ï¼ŒåŒ–å¦†å“ç²¾è‡´å‘ˆç°",
  "prompt_template_id": "tmpl_001",
  "template_weight": 0.856,
  "aesthetic_score": 0.88
}
```

### 4. Mockæ•°æ®æ¥å£

#### 4.1 åº”ç”¨åˆ—è¡¨

**ç«¯ç‚¹ï¼š** `GET /api/apps`

**å“åº”ï¼š**

```json
[
  {
    "id": "text_to_image",
    "name": "æ–‡ç”Ÿå›¾æ™ºèƒ½ç®¡çº¿",
    "description": "å¤šæ¨¡å‹å¹¶è¡Œç”Ÿæˆï¼Œæ™ºèƒ½è¯„åˆ†é€‰ä¼˜",
    "category": "generation",
    "icon": "âœ¨",
    "status": "active"
  },
  {
    "id": "image_to_image",
    "name": "å›¾ç”Ÿå›¾è¥é”€ç®¡çº¿",
    "description": "ä¸€æ‹å³åˆï¼Œå‚è€ƒå›¾æ™ºèƒ½åˆ†æ",
    "category": "marketing",
    "icon": "ğŸ¨",
    "status": "active"
  }
]
```

#### 4.2 ä½œå“åˆ—è¡¨

**ç«¯ç‚¹ï¼š** `GET /api/works`

**å“åº”ï¼š**

```json
[
  {
    "id": "work_001",
    "title": "æ¢¦å¹»æ£®æ—",
    "image_url": "https://cdn.example.com/work1.png",
    "author": "ç”¨æˆ·A",
    "likes": 128,
    "views": 1500,
    "created_at": "2025-11-01T10:30:00Z"
  }
]
```

#### 4.3 ä½œå“å›¾åº“ï¼ˆåˆ†é¡µï¼‰

**ç«¯ç‚¹ï¼š** `GET /api/mock/gallery?page=1&page_size=9`

**å“åº”ï¼š**

```json
{
  "page": 1,
  "page_size": 9,
  "has_more": true,
  "total": 50,
  "items": [
    {
      "id": "gallery_001-p1-i0",
      "image": "https://cdn.example.com/gallery1.png",
      "title": "ä½œå“æ ‡é¢˜",
      "scores": {
        "color_score": 8.5,
        "contrast_score": 8.2,
        "clarity_eval": 9.0,
        "noise_eval": 8.8,
        "quality_score": 8.6,
        "holistic": 8.7
      }
    }
  ]
}
```

#### 4.4 ç”¨æˆ·ä¿¡æ¯

**ç«¯ç‚¹ï¼š** `GET /api/user/{user_id}`

**å“åº”ï¼š**

```json
{
  "id": "user_001",
  "username": "å¼ ä¸‰",
  "avatar": "https://cdn.example.com/avatar.png",
  "quota": {
    "total": 1000,
    "used": 350,
    "remaining": 650
  },
  "stats": {
    "works": 25,
    "likes": 320,
    "followers": 150
  }
}
```

### 5. æä¾›å•†ä¿¡æ¯

**ç«¯ç‚¹ï¼š** `GET /api/providers`

**å“åº”ï¼š**

```json
[
  {
    "id": "qwen",
    "name": "é€šä¹‰åƒé—®",
    "description": "é˜¿é‡Œäº‘DashScopeï¼Œæ”¯æŒWanx 2.5æ¨¡å‹",
    "capabilities": ["text2image", "image2image"],
    "requires_api_key": true,
    "is_free": false,
    "status": "available"
  },
  {
    "id": "pollinations",
    "name": "Pollinations",
    "description": "å…è´¹Fluxæ¨¡å‹ï¼Œæ— éœ€APIå¯†é’¥",
    "capabilities": ["text2image"],
    "requires_api_key": false,
    "is_free": true,
    "status": "available"
  }
]
```

---

## å·¥ä½œæµç¨‹

### æ–‡ç”Ÿå›¾æ™ºèƒ½ç®¡çº¿æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·è¾“å…¥Prompt  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [å¯é€‰] Promptæ‰©å†™     â”‚  â† å½“å‰ä¸ºå ä½å®ç°
â”‚ LLMå¢å¼ºæç¤ºè¯æè¿°     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¤šæä¾›å•†å¹¶è¡Œç”Ÿæˆï¼ˆ1-4ä¸ªæä¾›å•†ï¼‰        â”‚
â”‚  æ¯ä¸ªæä¾›å•†ç”Ÿæˆ num_candidates å¼ å›¾   â”‚
â”‚  æ”¯æŒï¼šqwen, doubao, dalle, geminiç­‰  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ”¶é›†æ‰€æœ‰å€™é€‰å›¾ç‰‡                      â”‚
â”‚  GeneratedImage[]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è±†åŒ…Visionå¤šç»´ç¾å­¦è¯„åˆ†ï¼ˆä¼˜å…ˆï¼‰        â”‚
â”‚  - compositionï¼ˆæ„å›¾ï¼‰                â”‚
â”‚  - light_colorï¼ˆå…‰å½±è‰²å½©ï¼‰            â”‚
â”‚  - style_coherenceï¼ˆé£æ ¼ä¸€è‡´æ€§ï¼‰      â”‚
â”‚  - emotional_impactï¼ˆæƒ…æ„Ÿè¡¨è¾¾ï¼‰       â”‚
â”‚  - clarity_integrityï¼ˆæ¸…æ™°å®Œæ•´åº¦ï¼‰    â”‚
â”‚  - final_scoreï¼ˆç»¼åˆåˆ†ï¼‰              â”‚
â”‚  + æ¯ä¸ªç»´åº¦çš„ä¸“ä¸šç‚¹è¯„ï¼ˆä¸­æ–‡ï¼‰          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ è°ƒç”¨å¤±è´¥ï¼Ÿ
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [é™çº§] æŠ€æœ¯è¯„åˆ†æ¨¡å—                   â”‚
â”‚  - MNetæ•´ä½“ç¾å­¦è¯„åˆ†                   â”‚
â”‚  - è‰²å½©è¯„åˆ†ï¼ˆå ä½ï¼‰                    â”‚
â”‚  - å¯¹æ¯”åº¦è¯„åˆ†ï¼ˆå ä½ï¼‰                  â”‚
â”‚  - æ¸…æ™°åº¦è¯„ä¼°ï¼ˆå ä½ï¼‰                  â”‚
â”‚  - å™ªå£°è¯„ä¼°ï¼ˆå ä½ï¼‰                    â”‚
â”‚  - è´¨é‡è¯„åˆ†ï¼ˆå ä½ï¼‰                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é€‰æ‹©æœ€ä½³å€™é€‰                          â”‚
â”‚  ä¾æ®ï¼šholisticç»¼åˆåˆ†ï¼ˆ0-1åŒºé—´ï¼‰       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ„å»ºå“åº”ç»“æœ                          â”‚
â”‚  - æœ€ä½³å›¾ç‰‡URL                         â”‚
â”‚  - æ‰€æœ‰å€™é€‰å›¾+è¯„åˆ†                     â”‚
â”‚  - ä¸­æ–‡ç‚¹è¯„æ‘˜è¦                        â”‚
â”‚  - ä½¿ç”¨çš„æä¾›å•†åˆ—è¡¨                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¿”å›å‰ç«¯å±•ç¤º     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å›¾ç”Ÿå›¾è¥é”€ç®¡çº¿æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·ä¸Šä¼ å‚è€ƒå›¾ + è¾“å…¥éœ€æ±‚æè¿°     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è±†åŒ…Visionåˆ†æå‚è€ƒå›¾                 â”‚
â”‚  è¾“å…¥ï¼šreference_images[]            â”‚
â”‚  è¾“å‡ºï¼š{                              â”‚
â”‚    "product": "åŒ–å¦†å“",              â”‚
â”‚    "style": "è´¨æ„Ÿå•†ä¸šé£",            â”‚
â”‚    "style_keywords": [...],          â”‚
â”‚    "platform": "æ·˜å®",               â”‚
â”‚    "description": "...",             â”‚
â”‚    "embedding": [256-dim vector]    â”‚
â”‚  }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [å¯é€‰] Promptæ¨¡æ¿åº“æ£€ç´¢              â”‚
â”‚  - ä½¿ç”¨embeddingå‘é‡ç›¸ä¼¼åº¦æ£€ç´¢        â”‚
â”‚  - æ ¹æ®platform/productç­›é€‰          â”‚
â”‚  - èåˆæ¨¡æ¿å’Œç”¨æˆ·è¾“å…¥                 â”‚
â”‚  final_prompt = user_prompt + templateâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¤šæä¾›å•†å¹¶è¡Œç”Ÿæˆ                      â”‚
â”‚  å‚æ•°ï¼š                                â”‚
â”‚  - prompt: final_prompt              â”‚
â”‚  - reference_images                  â”‚
â”‚  - sequential_mode: auto/disabled    â”‚
â”‚  - num_variations: 1-3               â”‚
â”‚                                       â”‚
â”‚  ç‰¹æ®Šæ”¯æŒï¼šè±†åŒ…Seedreamé¡ºåºç”Ÿæˆæ¨¡å¼   â”‚
â”‚  (ä¸€æ¬¡è°ƒç”¨è¿”å›å¤šå¼ æ¸è¿›ä¼˜åŒ–çš„å›¾)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è±†åŒ…Visionç¾å­¦è¯„åˆ†                   â”‚
â”‚  åŒæ–‡ç”Ÿå›¾ç®¡çº¿ï¼Œè¿”å›6ä¸ªç»´åº¦è¯„åˆ†+ç‚¹è¯„    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è±†åŒ…Visionä¸€è‡´æ€§æ£€æµ‹                 â”‚
â”‚  è¾“å…¥ï¼šreference_images + candidate   â”‚
â”‚  Promptï¼š                             â”‚
â”‚    "ä½ æ˜¯ç”µå•†å•†å“ä¸€è‡´æ€§å®¡æ ¸åŠ©æ‰‹ã€‚      â”‚
â”‚     è¯·æ¯”è¾ƒå€™é€‰å›¾ç‰‡ä¸å‚è€ƒå›¾ç‰‡çš„ä¸»ä½“     â”‚
â”‚     æ˜¯å¦ä¸€è‡´..."                      â”‚
â”‚  è¾“å‡ºï¼š{                              â”‚
â”‚    "score": 0.92,  # 0-1åˆ†          â”‚
â”‚    "comment": "ä¸»ä½“ä¸€è‡´ï¼Œè‰²è°ƒç›¸è¿‘"   â”‚
â”‚  }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç»¼åˆæ’åº                              â”‚
â”‚  primary_score = holistic (ç¾å­¦ç»¼åˆåˆ†)â”‚
â”‚  å¯æ‰©å±•ä¸ºï¼š                            â”‚
â”‚    Î± * aesthetic + Î² * consistency   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¾å­¦åé¦ˆæœºåˆ¶                          â”‚
â”‚  if prompt_bank_enabled:             â”‚
â”‚    new_weight = Î± * old + (1-Î±) * scoreâ”‚
â”‚    update_template_weight()          â”‚
â”‚  å®ç°åœ¨çº¿å­¦ä¹ å’Œæ¨¡æ¿ä¼˜åŒ–                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  äº‹ä»¶æ—¥å¿—è®°å½•                          â”‚
â”‚  logs/doubao_events.jsonl:           â”‚
â”‚  - analysis_response                 â”‚
â”‚  - consistency_response              â”‚
â”‚  logs/pipeline_runs.jsonl:           â”‚
â”‚  - provider_results                  â”‚
â”‚  - pipeline_summary                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¿”å›å‰ç«¯å±•ç¤º     â”‚
â”‚  - æ‰€æœ‰å€™é€‰+è¯„åˆ†  â”‚
â”‚  - ä¸€è‡´æ€§åˆ†æ•°     â”‚
â”‚  - æœ€ä½³æ¨è       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

**å¿…éœ€é…ç½®ï¼š**

| ç¯å¢ƒå˜é‡ | è¯´æ˜ | ç¤ºä¾‹ |
|----------|------|------|
| `DASHSCOPE_API_KEY` æˆ– `QWEN_API_KEY` | é€šä¹‰åƒé—®APIå¯†é’¥ | `sk-xxxxx` |
| `ARK_API_KEY` æˆ– `DOUBAO_API_KEY` | è±†åŒ…Seedreamå’ŒVision APIå¯†é’¥ | `Bearer xxxxx` |
| `OPENAI_API_KEY` | OpenAI DALLÂ·E APIå¯†é’¥ | `sk-xxxxx` |

**è±†åŒ…ç¾å­¦è¯„åˆ†é…ç½®ï¼š**

| ç¯å¢ƒå˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ |
|----------|------|--------|
| `HOLISTIC_MODEL` | è±†åŒ…Visionæ¨¡å‹åç§° | `doubao-seed-1-6-vision` |
| `HOLISTIC_PROMPT` | ç¾å­¦è¯„åˆ†æç¤ºè¯æ–‡ä»¶è·¯å¾„ | `prompts/doubao_aesthetic.prompt` |
| `DOUBAO_VISION_URL` | è±†åŒ…APIåœ°å€ | `https://ark.cn-beijing.volces.com/api/v3/chat/completions` |

**å¯é€‰é…ç½®ï¼š**

| ç¯å¢ƒå˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ |
|----------|------|--------|
| `GLOBAL_HTTP_PROXY` | å…¨å±€HTTPä»£ç† | æ—  |
| `HOLISTIC_SCORE_TOKEN` | MNetè¯„åˆ†æœåŠ¡Token | æ—  |
| `HOLISTIC_SCORE_URL` | MNetæœåŠ¡åœ°å€ | æ—  |
| `ARK_ANALYSIS_MODEL` | è±†åŒ…å›¾åƒåˆ†ææ¨¡å‹ | `doubao-seed-1-6-251015` |
| `DOUBAO_LOG_PATH` | è±†åŒ…æ—¥å¿—è·¯å¾„ | `logs/doubao_events.jsonl` |
| `PIPELINE_LOG_PATH` | ç®¡çº¿æ—¥å¿—è·¯å¾„ | `logs/pipeline_runs.jsonl` |
| `VITE_AE_API` | å‰ç«¯APIåœ°å€ | `http://127.0.0.1:8000` |

### é…ç½®æ–‡ä»¶

**config/config.yaml:**

```yaml
holistic_model: doubao-seed-1-6-vision
holistic_prompt: prompts/doubao_aesthetic.prompt
```

**prompts/doubao_aesthetic.prompt:**

```
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„è§†è§‰è‰ºæœ¯è¯„è®ºå®¶ã€‚
è¯·å¯¹è¾“å…¥å›¾åƒä»äº”ä¸ªç»´åº¦è¿›è¡Œå®¡ç¾åˆ†æå¹¶è¾“å‡ºJSONï¼š

{
  "composition": {"score": number, "comment": "â‰¤50å­—"},
  "light_color": {"score": number, "comment": "â‰¤50å­—"},
  "style_coherence": {"score": number, "comment": "â‰¤50å­—"},
  "emotional_impact": {"score": number, "comment": "â‰¤50å­—"},
  "clarity_integrity": {"score": number, "comment": "â‰¤50å­—"},
  "final_score": number
}

çº¦æŸï¼š
- scoreèŒƒå›´1~10ï¼Œä¿ç•™1ä½å°æ•°
- final_score = 0.75 * mean(aesthetic_scores) + 0.25 * clarity_integrity
- è¾“å‡ºå¿…é¡»æ˜¯åˆæ³•JSONï¼Œæ— ä»»ä½•é¢å¤–æ–‡æœ¬
```

---

## éƒ¨ç½²æŒ‡å—

### æœ¬åœ°å¼€å‘

#### åç«¯å¯åŠ¨

```bash
# 1. å…‹éš†é¡¹ç›®
cd /path/to/AestheticsEngine

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
python3.10 -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 3. å®‰è£…ä¾èµ–
pip install -e .[dev]

# 4. é…ç½®ç¯å¢ƒå˜é‡
export DASHSCOPE_API_KEY="sk-xxxxx"
export ARK_API_KEY="Bearer xxxxx"
export OPENAI_API_KEY="sk-xxxxx"
export HOLISTIC_MODEL="doubao-seed-1-6-vision"
export HOLISTIC_PROMPT="prompts/doubao_aesthetic.prompt"

# 5. å¯åŠ¨æœåŠ¡
uvicorn gateway.main:app --reload --host 0.0.0.0 --port 8000
```

#### å‰ç«¯å¯åŠ¨

```bash
# 1. è¿›å…¥å‰ç«¯ç›®å½•
cd frontend

# 2. å®‰è£…ä¾èµ–ï¼ˆNode.js 20.19+ï¼‰
npm install

# 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# 4. è‡ªå®šä¹‰APIåœ°å€ï¼ˆå¯é€‰ï¼‰
VITE_AE_API="http://your-host:8000" npm run dev
```

#### è¿è¡Œæµ‹è¯•

```bash
# åç«¯æµ‹è¯•
pytest

# å‰ç«¯æµ‹è¯•
cd frontend
npm run lint
```

### Dockeréƒ¨ç½²

```bash
# 1. è¿›å…¥åŸºç¡€è®¾æ–½ç›®å½•
cd infra

# 2. æ„å»ºå¹¶å¯åŠ¨æœåŠ¡
docker-compose up --build

# 3. åå°è¿è¡Œ
docker-compose up -d

# 4. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f gateway

# 5. åœæ­¢æœåŠ¡
docker-compose down
```

**docker-compose.yml ç¤ºä¾‹ï¼š**

```yaml
version: '3.8'

services:
  gateway:
    build:
      context: ..
      dockerfile: infra/dockerfiles/gateway.Dockerfile
    ports:
      - "8000:8000"
    environment:
      - DASHSCOPE_API_KEY=${DASHSCOPE_API_KEY}
      - ARK_API_KEY=${ARK_API_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - HOLISTIC_MODEL=doubao-seed-1-6-vision
      - HOLISTIC_PROMPT=prompts/doubao_aesthetic.prompt
    volumes:
      - ../logs:/app/logs
      - ../prompts:/app/prompts
    restart: unless-stopped
```

### ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹

1. **å¯†é’¥ç®¡ç†**
   - ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†æœåŠ¡ï¼ˆå¦‚AWS Secrets Managerï¼‰
   - ä¸è¦å°†APIå¯†é’¥æäº¤åˆ°ä»£ç ä»“åº“

2. **HTTPSé…ç½®**
   - ä½¿ç”¨Nginxæˆ–Caddyä½œä¸ºåå‘ä»£ç†
   - é…ç½®SSLè¯ä¹¦

3. **æ—¥å¿—ç®¡ç†**
   - é…ç½®æ—¥å¿—è½®è½¬ï¼ˆlogrotateï¼‰
   - ä½¿ç”¨é›†ä¸­å¼æ—¥å¿—ç³»ç»Ÿï¼ˆå¦‚ELKï¼‰

4. **ç›‘æ§å‘Šè­¦**
   - é…ç½®å¥åº·æ£€æŸ¥ç«¯ç‚¹
   - ç›‘æ§APIè°ƒç”¨é‡å’Œé”™è¯¯ç‡
   - è®¾ç½®è±†åŒ…APIé…é¢å‘Šè­¦

5. **æ€§èƒ½ä¼˜åŒ–**
   - å¯ç”¨HTTP/2
   - é…ç½®åˆç†çš„å¹¶å‘æ•°å’Œè¶…æ—¶æ—¶é—´
   - ä½¿ç”¨CDNåŠ é€Ÿé™æ€èµ„æº

---

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„ç”Ÿæˆæä¾›å•†

#### æ­¥éª¤1ï¼šåˆ›å»ºé€‚é…å™¨

åœ¨ `services/generate/adapters/` åˆ›å»ºæ–°æ–‡ä»¶ `my_provider.py`ï¼š

```python
from __future__ import annotations
from typing import Dict, Any
from services.generate.adapters.base import BaseProvider
from services.generate.models import GenerateRequestPayload

class MyProviderAdapter(BaseProvider):
    @property
    def name(self) -> str:
        return "my_provider"

    async def generate(self, request: GenerateRequestPayload) -> Dict[str, Any]:
        # å®ç°ç”Ÿæˆé€»è¾‘
        # ...

        return {
            "status": "success",
            "images": [image_url1, image_url2],  # æˆ– "image_url": single_url
            "metadata": {
                "model": "my-model-v1",
                "seed": 12345,
            }
        }
```

#### æ­¥éª¤2ï¼šæ³¨å†Œæä¾›å•†

åœ¨ `services/generate/__init__.py` æ³¨å†Œï¼š

```python
from services.generate.adapters.my_provider import MyProviderAdapter

_PROVIDERS = {
    # ... ç°æœ‰æä¾›å•†
    "my_provider": MyProviderAdapter(),
}
```

#### æ­¥éª¤3ï¼šæ·»åŠ æä¾›å•†ä¿¡æ¯

åœ¨ `services/generate/routes/provider_info.py` æ·»åŠ å…ƒæ•°æ®ï¼š

```python
PROVIDERS_INFO = [
    # ... ç°æœ‰æä¾›å•†
    {
        "id": "my_provider",
        "name": "æˆ‘çš„æä¾›å•†",
        "description": "æä¾›å•†è¯´æ˜",
        "capabilities": ["text2image"],
        "requires_api_key": True,
        "is_free": False,
        "status": "available"
    }
]
```

### æ·»åŠ æ–°çš„è¯„åˆ†æ¨¡å—

#### æ­¥éª¤1ï¼šåˆ›å»ºæœåŠ¡ç±»

åœ¨ `services/scoring/my_score/` åˆ›å»º `service.py`ï¼š

```python
from __future__ import annotations
from uuid import UUID
from services.common.models import GeneratedImage
from services.scoring.base import ScoreService

class MyScoreService(ScoreService):
    @property
    def module_name(self) -> str:
        return "my_score"

    async def score(self, *, task_id: UUID, image: GeneratedImage) -> float:
        # å®ç°è¯„åˆ†é€»è¾‘
        # è¿”å›0-1ä¹‹é—´çš„æµ®ç‚¹æ•°
        return 0.85
```

#### æ­¥éª¤2ï¼šæ³¨å†Œåˆ°èšåˆå™¨

åœ¨ `services/scoring/aggregator.py` æ³¨å†Œï¼š

```python
from services.scoring.my_score.service import MyScoreService

class ScoringAggregator:
    def __init__(self, services: Iterable[ScoreService] | None = None):
        default_services: Sequence[ScoreService] = services or (
            HolisticScoreService(),
            ColorScoreService(),
            # ... ç°æœ‰æ¨¡å—
            MyScoreService(),  # æ·»åŠ æ–°æ¨¡å—
        )
        # ...
```

### è‡ªå®šä¹‰å‰ç«¯é¡µé¢

#### æ­¥éª¤1ï¼šåˆ›å»ºé¡µé¢ç»„ä»¶

åœ¨ `frontend/src/pages/` åˆ›å»º `my-page.tsx`ï¼š

```typescript
import React from 'react';

export default function MyPage() {
  return (
    <div className="container mx-auto p-8">
      <h1 className="text-3xl font-bold">æˆ‘çš„é¡µé¢</h1>
      {/* é¡µé¢å†…å®¹ */}
    </div>
  );
}
```

#### æ­¥éª¤2ï¼šæ·»åŠ è·¯ç”±

åœ¨ `frontend/src/App.tsx` æ·»åŠ è·¯ç”±ï¼š

```typescript
import MyPage from './pages/my-page';

function App() {
  return (
    <BrowserRouter>
      <Routes>
        {/* ... ç°æœ‰è·¯ç”± */}
        <Route path="/my-page" element={<MyPage />} />
      </Routes>
    </BrowserRouter>
  );
}
```

### è°ƒè¯•æŠ€å·§

#### æŸ¥çœ‹è±†åŒ…APIè°ƒç”¨æ—¥å¿—

```bash
tail -f logs/doubao_events.jsonl | jq .
```

#### æŸ¥çœ‹ç®¡çº¿è¿è¡Œæ—¥å¿—

```bash
tail -f logs/pipeline_runs.jsonl | jq .
```

#### æµ‹è¯•å•ä¸ªæä¾›å•†

```bash
cd tests
pytest Qwen_test.py -v
```

#### æµ‹è¯•ç®¡çº¿ç«¯ç‚¹

```bash
pytest test_pipeline_endpoint.py -v
```

---

## å‰ç«¯åº”ç”¨

### é¡µé¢åˆ—è¡¨

| è·¯ç”± | é¡µé¢åç§° | åŠŸèƒ½è¯´æ˜ |
|------|----------|----------|
| `/ai-application` | åº”ç”¨å¹¿åœº | å±•ç¤ºæ‰€æœ‰å¯ç”¨çš„AIåº”ç”¨å¡ç‰‡ï¼Œæ”¯æŒç±»å‹ç­›é€‰ |
| `/ai-detail/:id` | ä»»åŠ¡æ§åˆ¶å° | æ—§ç‰ˆä»»åŠ¡è¯¦æƒ…é¡µï¼ˆä¿ç•™ï¼‰ |
| `/generate` | æ–‡ç”Ÿå›¾æ™ºèƒ½ç®¡çº¿ | å¤šæ¨¡å‹å¹¶è¡Œç”Ÿæˆï¼Œå®æ—¶è¿›åº¦ï¼Œè¯„åˆ†é›·è¾¾å›¾ |
| `/image-compose` | å›¾ç”Ÿå›¾è¥é”€å›¾ | å‚è€ƒå›¾ä¸Šä¼ ï¼Œæ¨¡æ¿é€‰æ‹©ï¼Œä¸€è‡´æ€§è¯„åˆ† |
| `/workspace` | ç¾å­¦å·¥ä½œå° | ç€‘å¸ƒæµä½œå“å±•ç¤ºï¼Œè¯„åˆ†å¯è§†åŒ– |
| `/marketplace` | ä½œå“å¸‚åœº | å ä½é¡µé¢ï¼ˆå¾…æ‰©å±•ï¼‰ |
| `/profile` | ç”¨æˆ·ä¸­å¿ƒ | å ä½é¡µé¢ï¼ˆå¾…æ‰©å±•ï¼‰ |

### æ ¸å¿ƒç»„ä»¶

#### ScoreRadarChartï¼ˆè¯„åˆ†é›·è¾¾å›¾ï¼‰

**ä½ç½®ï¼š** `frontend/src/components/ScoreRadarChart.tsx`

**åŠŸèƒ½ï¼š** ä½¿ç”¨Rechartså±•ç¤º6ç»´åº¦è¯„åˆ†ï¼ˆ1-10åˆ†åˆ¶ï¼‰

**ç¤ºä¾‹ï¼š**

```typescript
<ScoreRadarChart
  scores={{
    color_score: 8.5,
    contrast_score: 8.2,
    clarity_eval: 9.0,
    noise_eval: 8.8,
    quality_score: 8.6,
    holistic: 8.7
  }}
/>
```

#### GenerateProgressï¼ˆç”Ÿæˆè¿›åº¦ï¼‰

**ä½ç½®ï¼š** `frontend/src/components/GenerateProgress.tsx`

**åŠŸèƒ½ï¼š** å±•ç¤ºå¤šé˜¶æ®µç”Ÿæˆå’Œè¯„åˆ†çš„å®æ—¶è¿›åº¦

**é˜¶æ®µï¼š**
1. æ­£åœ¨ç”Ÿæˆå›¾ç‰‡...
2. æ­£åœ¨è¯„åˆ†...
3. æ­£åœ¨é€‰æ‹©æœ€ä½³å€™é€‰...
4. å®Œæˆï¼

#### ImagePreviewModalï¼ˆå›¾ç‰‡é¢„è§ˆï¼‰

**ä½ç½®ï¼š** `frontend/src/components/ImagePreviewModal.tsx`

**åŠŸèƒ½ï¼š** ç‚¹å‡»ç¼©ç•¥å›¾æ”¾å¤§æŸ¥çœ‹ï¼Œæ”¯æŒä¸‹è½½

### UIç‰¹ç‚¹

1. **Appleé£æ ¼è®¾è®¡**
   - ç®€æ´ä¼˜é›…çš„ç•Œé¢
   - æµç•…çš„è¿‡æ¸¡åŠ¨ç”»ï¼ˆFramer Motionï¼‰
   - æ¯›ç»ç’ƒæ•ˆæœå’Œæ¸å˜èƒŒæ™¯

2. **å“åº”å¼å¸ƒå±€**
   - å®½å±å¸ƒå±€é€‚é…å¤§å±
   - ç½‘æ ¼å¸ƒå±€è‡ªé€‚åº”

3. **å®æ—¶åé¦ˆ**
   - è¿›åº¦æ¡å’ŒåŠ è½½åŠ¨ç”»
   - Toastæ¶ˆæ¯æç¤º
   - éª¨æ¶å±å ä½

4. **æ‰¹é‡æ“ä½œ**
   - å¤šé€‰å€™é€‰å›¾
   - æ‰¹é‡ä¸‹è½½ä¸ºZIP
   - ä¸€é”®å…¨é€‰

### å‰ç«¯APIè°ƒç”¨

**å°è£…ä½ç½®ï¼š** `frontend/src/lib/api.ts`

**ç¤ºä¾‹ï¼š**

```typescript
import { api } from '@/lib/api';

// æ–‡ç”Ÿå›¾ç®¡çº¿
const result = await api.text2image({
  prompt: 'æ¢¦å¹»æ£®æ—',
  providers: ['qwen', 'pollinations'],
  num_candidates: 3,
  params: {
    ratio: '16:9',
    expand_prompt: false,
  }
});

// å›¾ç”Ÿå›¾ç®¡çº¿
const result = await api.image2image({
  prompt: 'æ¸…æ–°è‡ªç„¶',
  reference_images: [imageUrl],
  providers: ['qwen'],
  params: {
    platform: 'æ·˜å®',
    style: 'æ¸…æ–°',
  }
});
```

---

## æŠ€æœ¯äº®ç‚¹

### 1. å¼‚æ­¥å¹¶å‘æ¶æ„

- **httpxå¼‚æ­¥å®¢æˆ·ç«¯**ï¼šé«˜æ•ˆå¤„ç†å¤šä¸ªAPIè°ƒç”¨
- **asyncio.gather**ï¼šå¹¶è¡Œæ‰§è¡Œç”Ÿæˆå’Œè¯„åˆ†ä»»åŠ¡
- **é™ä½å»¶è¿Ÿ**ï¼šå¤šæ¨¡å‹å¹¶è¡Œç”Ÿæˆï¼Œæ€»è€—æ—¶â‰ˆå•ä¸ªæ¨¡å‹è€—æ—¶

### 2. æ™ºèƒ½é™çº§ç­–ç•¥

```python
# è±†åŒ…APIä¼˜å…ˆï¼Œå¤±è´¥æ—¶è‡ªåŠ¨å›é€€
doubao_result = await self._fetch_doubao_scores(image)
if doubao_result:
    module_scores.update(doubao_result.scores)
else:
    # è°ƒç”¨æŠ€æœ¯è¯„åˆ†æ¨¡å—
    for service in services:
        score = await service.score(task_id, image)
        module_scores[service.module_name] = score
```

### 3. é€‚é…å™¨æ¨¡å¼

- **ç»Ÿä¸€æ¥å£**ï¼šBaseProvideræŠ½è±¡ç±»å®šä¹‰æ ‡å‡†æ–¹æ³•
- **çµæ´»æ‰©å±•**ï¼šæ–°å¢æä¾›å•†åªéœ€å®ç°æ¥å£
- **é›¶ä¾µå…¥**ï¼šä¸å½±å“ç°æœ‰ä»£ç 

### 4. Pydanticæ•°æ®éªŒè¯

- **è¯·æ±‚éªŒè¯**ï¼šè‡ªåŠ¨æ ¡éªŒå‚æ•°ç±»å‹å’ŒèŒƒå›´
- **å“åº”åºåˆ—åŒ–**ï¼šè‡ªåŠ¨è½¬æ¢ä¸ºJSON
- **ç±»å‹å®‰å…¨**ï¼šTypeScriptå‰ç«¯è·å¾—å‡†ç¡®çš„ç±»å‹æç¤º

### 5. äº‹ä»¶æ—¥å¿—ç³»ç»Ÿ

- **å®Œæ•´è¿½æº¯**ï¼šè®°å½•æ‰€æœ‰è±†åŒ…APIè°ƒç”¨å’Œç®¡çº¿äº‹ä»¶
- **JSONLæ ¼å¼**ï¼šä¾¿äºæµå¼è¿½åŠ å’Œè§£æ
- **è°ƒè¯•åˆ©å™¨**ï¼šå¿«é€Ÿå®šä½é—®é¢˜å’Œä¼˜åŒ–æç¤ºè¯

### 6. åœ¨çº¿å­¦ä¹ æœºåˆ¶

```python
# ç¾å­¦åé¦ˆæ›´æ–°Promptæ¨¡æ¿æƒé‡
new_weight = Î± * old_weight + (1 - Î±) * aesthetic_score
prompt_bank.update_weight(template_id, new_weight)
```

### 7. è±†åŒ…Visionæ·±åº¦é›†æˆ

- **å¤šç»´åº¦è¯„åˆ†**ï¼š5ä¸ªç¾å­¦ç»´åº¦ + 1ä¸ªç»¼åˆåˆ†
- **ä¸“ä¸šç‚¹è¯„**ï¼šæ¯ä¸ªç»´åº¦è¿”å›ä¸­æ–‡è§£é‡Šï¼ˆâ‰¤50å­—ï¼‰
- **ä¸€è‡´æ€§æ£€æµ‹**ï¼šå›¾ç”Ÿå›¾åœºæ™¯çš„ä¸»ä½“ä¸€è‡´æ€§éªŒè¯
- **å‚è€ƒå›¾åˆ†æ**ï¼šæ™ºèƒ½è¯†åˆ«äº§å“ç±»åˆ«ã€é£æ ¼ã€å…³é”®è¯

---

## å¾…åŠäº‹é¡¹

### é«˜ä¼˜å…ˆçº§

- [ ] **å®Œå–„è±†åŒ…APIé«˜å¯ç”¨ç­–ç•¥**
  - [ ] å®ç°é‡è¯•æœºåˆ¶ï¼ˆæŒ‡æ•°é€€é¿ï¼‰
  - [ ] æ·»åŠ å“åº”ç¼“å­˜ï¼ˆç›¸åŒå›¾ç‰‡60ç§’å†…å¤ç”¨ï¼‰
  - [ ] é…ç½®é™æµä¿æŠ¤ï¼ˆé¿å…è¶…å‡ºé…é¢ï¼‰
  - [ ] å®ç°ç†”æ–­é™çº§ï¼ˆè¿ç»­å¤±è´¥Næ¬¡åä¸´æ—¶åœç”¨ï¼‰

- [ ] **æ›¿æ¢å ä½çš„æŠ€æœ¯è¯„åˆ†æ¨¡å—**
  - [ ] `color_score`ï¼šæ¥å…¥çœŸå®è‰²å½©åˆ†æç®—æ³•
  - [ ] `contrast_score`ï¼šå®ç°å¯¹æ¯”åº¦å’Œæ„å›¾è¯„ä¼°
  - [ ] `clarity_eval`ï¼šé›†æˆæ¸…æ™°åº¦æ£€æµ‹æ¨¡å‹
  - [ ] `noise_eval`ï¼šæ·»åŠ å™ªå£°å’Œé£æ ¼ä¸€è‡´æ€§æ£€æµ‹
  - [ ] `quality_score`ï¼šå®ç°æ•´ä½“è´¨é‡è¯„åˆ†

- [ ] **å®ç°Promptæ™ºèƒ½æ‰©å†™**
  - [ ] æ¥å…¥LLMï¼ˆå¦‚é€šä¹‰åƒé—®ã€è±†åŒ…ï¼‰
  - [ ] æ ¹æ®ç”¨æˆ·ç®€çŸ­æè¿°ç”Ÿæˆè¯¦ç»†Prompt
  - [ ] æ”¯æŒé£æ ¼åŒ–æŒ‡ä»¤ï¼ˆå¦‚"æ¢µé«˜é£æ ¼"â†’å…·ä½“æè¿°ï¼‰

- [ ] **å¢å¼ºæ¨¡å—æ¥å…¥**
  - [ ] é›†æˆReal-ESRGANè¶…åˆ†è¾¨ç‡
  - [ ] æ·»åŠ å»å™ªç®—æ³•
  - [ ] å®ç°å›¾åƒä¿®å¤åŠŸèƒ½

### ä¸­ä¼˜å…ˆçº§

- [ ] **ç”Ÿæˆç»“æœæŒä¹…åŒ–**
  - [ ] è®¾è®¡æ•°æ®åº“æ¨¡å¼ï¼ˆPostgreSQL/MongoDBï¼‰
  - [ ] å®ç°ä»»åŠ¡çŠ¶æ€ç®¡ç†
  - [ ] æ”¯æŒå†å²è®°å½•æŸ¥è¯¢

- [ ] **ç´ æç®¡ç†ç³»ç»Ÿ**
  - [ ] ç”¨æˆ·ä½œå“åº“
  - [ ] æ ‡ç­¾å’Œåˆ†ç±»
  - [ ] æ”¶è—å’Œåˆ†äº«åŠŸèƒ½

- [ ] **ç”¨æˆ·ç³»ç»Ÿ**
  - [ ] æ³¨å†Œå’Œç™»å½•
  - [ ] é…é¢ç®¡ç†
  - [ ] ä½¿ç”¨ç»Ÿè®¡

- [ ] **ä½œå“å¸‚åœº**
  - [ ] ä½œå“å‘å¸ƒå’Œå®¡æ ¸
  - [ ] ç‚¹èµå’Œè¯„è®º
  - [ ] æ’è¡Œæ¦œ

### ä½ä¼˜å…ˆçº§

- [ ] **ç›‘æ§å’Œæ—¥å¿—åˆ†æ**
  - [ ] Prometheus + Grafanaç›‘æ§
  - [ ] ELKæ—¥å¿—åˆ†æ
  - [ ] æ€§èƒ½è¿½è¸ª

- [ ] **å›½é™…åŒ–ï¼ˆi18nï¼‰**
  - [ ] è‹±æ–‡ç•Œé¢æ”¯æŒ
  - [ ] å¤šè¯­è¨€Promptæ¨¡æ¿

- [ ] **ç§»åŠ¨ç«¯é€‚é…**
  - [ ] å“åº”å¼ä¼˜åŒ–
  - [ ] PWAæ”¯æŒ

- [ ] **æ’ä»¶ç³»ç»Ÿ**
  - [ ] æ”¯æŒç¬¬ä¸‰æ–¹è¯„åˆ†æ¨¡å—
  - [ ] æ”¯æŒè‡ªå®šä¹‰æä¾›å•†

---

## å¸¸è§é—®é¢˜

### Q1ï¼šè±†åŒ…APIè°ƒç”¨å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A**ï¼šç³»ç»Ÿä¼šè‡ªåŠ¨é™çº§åˆ°æŠ€æœ¯è¯„åˆ†æ¨¡å—ï¼ˆMNetç­‰ï¼‰ã€‚æ£€æŸ¥ä»¥ä¸‹é…ç½®ï¼š
- ç¯å¢ƒå˜é‡ `ARK_API_KEY` æˆ– `DOUBAO_API_KEY` æ˜¯å¦æ­£ç¡®
- ç¯å¢ƒå˜é‡ `HOLISTIC_MODEL` æ˜¯å¦è®¾ç½®ï¼ˆé»˜è®¤ï¼š`doubao-seed-1-6-vision`ï¼‰
- æç¤ºè¯æ–‡ä»¶ `prompts/doubao_aesthetic.prompt` æ˜¯å¦å­˜åœ¨
- æŸ¥çœ‹æ—¥å¿— `logs/doubao_events.jsonl` è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

### Q2ï¼šå¦‚ä½•å…è´¹æµ‹è¯•é¡¹ç›®ï¼Ÿ

**A**ï¼šä½¿ç”¨Pollinationsæä¾›å•†ï¼Œæ— éœ€APIå¯†é’¥ï¼š

```json
{
  "prompt": "ä¸€åªçŒ«éª‘ç€è‡ªè¡Œè½¦",
  "providers": ["pollinations"],
  "num_candidates": 2
}
```

### Q3ï¼šç”Ÿæˆå›¾ç‰‡å¾ˆæ…¢æ€ä¹ˆåŠï¼Ÿ

**A**ï¼š
- å‡å°‘ `num_candidates` æ•°é‡
- é€‰æ‹©é€Ÿåº¦å¿«çš„æä¾›å•†ï¼ˆå¦‚Pollinationsï¼‰
- ä½¿ç”¨æ›´å°çš„å›¾ç‰‡å°ºå¯¸ï¼ˆå¦‚ `1024x1024` è€Œé `2048x2048`ï¼‰
- æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œä»£ç†è®¾ç½®

### Q4ï¼šå¦‚ä½•æŸ¥çœ‹ç”Ÿæˆçš„å›¾ç‰‡ï¼Ÿ

**A**ï¼š
- å‰ç«¯è®¿é—® `http://localhost:5173/generate`ï¼ˆæ–‡ç”Ÿå›¾ï¼‰æˆ– `/image-compose`ï¼ˆå›¾ç”Ÿå›¾ï¼‰
- åç«¯è¿”å›çš„ `image_url` å¯ç›´æ¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
- éƒ¨åˆ†æä¾›å•†è¿”å› `data:image/...` æ ¼å¼çš„base64å›¾ç‰‡

### Q5ï¼šè¯„åˆ†ç»´åº¦çš„ä¸­è‹±æ–‡å¯¹åº”å…³ç³»ï¼Ÿ

**A**ï¼š

| è±†åŒ…è¿”å›ï¼ˆä¸­æ–‡ï¼‰ | ç³»ç»Ÿå†…éƒ¨åç§° | å‰ç«¯æ˜¾ç¤º |
|-----------------|--------------|----------|
| composition | contrast_score | æ„å›¾è¡¨è¾¾ |
| light_color | color_score | å…‰è‰²è¡¨ç° |
| style_coherence | noise_eval | é£æ ¼åè°ƒæ€§ |
| emotional_impact | quality_score | æƒ…ç»ªæ„ŸæŸ“åŠ› |
| clarity_integrity | clarity_eval | æ¸…æ™°å®Œæ•´åº¦ |
| final_score | holistic | ç»¼åˆç¾æ„Ÿ |

### Q6ï¼šå¦‚ä½•è‡ªå®šä¹‰è±†åŒ…è¯„åˆ†æç¤ºè¯ï¼Ÿ

**A**ï¼šç¼–è¾‘ `prompts/doubao_aesthetic.prompt` æ–‡ä»¶ï¼Œä¿®æ”¹è¯„åˆ†æ ‡å‡†å’Œç»´åº¦æƒé‡ã€‚ç¤ºä¾‹ï¼š

```
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„è§†è§‰è‰ºæœ¯è¯„è®ºå®¶ã€‚
è¯·å¯¹è¾“å…¥å›¾åƒä»äº”ä¸ªç»´åº¦è¿›è¡Œå®¡ç¾åˆ†æå¹¶è¾“å‡ºJSONï¼š

{
  "composition": {"score": number, "comment": "â‰¤50å­—"},
  ...
}

çº¦æŸï¼š
- scoreèŒƒå›´1~10ï¼Œä¿ç•™1ä½å°æ•°
- final_score = 0.8 * mean(aesthetic_scores) + 0.2 * clarity_integrity  # è°ƒæ•´æƒé‡
- è¾“å‡ºå¿…é¡»æ˜¯åˆæ³•JSONï¼Œæ— ä»»ä½•é¢å¤–æ–‡æœ¬
```

### Q7ï¼šDockeréƒ¨ç½²æ—¶å¦‚ä½•ä¼ é€’ç¯å¢ƒå˜é‡ï¼Ÿ

**A**ï¼šåˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
# .env
DASHSCOPE_API_KEY=sk-xxxxx
ARK_API_KEY=Bearer xxxxx
OPENAI_API_KEY=sk-xxxxx
```

åœ¨ `docker-compose.yml` ä¸­å¼•ç”¨ï¼š

```yaml
services:
  gateway:
    env_file:
      - .env
```

æˆ–ç›´æ¥åœ¨å‘½ä»¤è¡Œä¼ é€’ï¼š

```bash
DASHSCOPE_API_KEY=sk-xxxxx docker-compose up
```

### Q8ï¼šå‰ç«¯å¦‚ä½•è¿æ¥åˆ°è¿œç¨‹åç«¯ï¼Ÿ

**A**ï¼šå¯åŠ¨å‰ç«¯æ—¶è®¾ç½® `VITE_AE_API` ç¯å¢ƒå˜é‡ï¼š

```bash
VITE_AE_API="https://your-backend.com" npm run dev
```

æˆ–ä¿®æ”¹ `frontend/.env`ï¼š

```
VITE_AE_API=https://your-backend.com
```

### Q9ï¼šå¦‚ä½•æ·»åŠ æ–°çš„å›¾ç‰‡ç”Ÿæˆæä¾›å•†ï¼Ÿ

**A**ï¼šå‚è€ƒ [å¼€å‘æŒ‡å— - æ·»åŠ æ–°çš„ç”Ÿæˆæä¾›å•†](#æ·»åŠ æ–°çš„ç”Ÿæˆæä¾›å•†) ç« èŠ‚ã€‚

### Q10ï¼šé¡¹ç›®æ”¯æŒå“ªäº›Pythonç‰ˆæœ¬ï¼Ÿ

**A**ï¼šPython 3.10+ï¼ˆæ¨è3.10æˆ–3.11ï¼‰ã€‚ä½¿ç”¨äº†ç±»å‹æ³¨è§£çš„æ–°ç‰¹æ€§ï¼ˆå¦‚ `X | Y` è”åˆç±»å‹ï¼‰ã€‚

---

## é™„å½•

### æ–‡ä»¶è·¯å¾„ç´¢å¼•

#### æ ¸å¿ƒæ–‡ä»¶

- **ä¸»å…¥å£**ï¼š`gateway/main.py:182`
- **æœåŠ¡ç¼–æ’**ï¼š`gateway/orchestrator.py:87`
- **æ–‡ç”Ÿå›¾ç®¡çº¿**ï¼š`services/pipeline/text2image.py:323`
- **å›¾ç”Ÿå›¾ç®¡çº¿**ï¼š`services/pipeline/image2image.py:881`
- **è¯„åˆ†èšåˆå™¨**ï¼š`services/scoring/aggregator.py:154`
- **è±†åŒ…å®¢æˆ·ç«¯**ï¼š`services/scoring/holistic/doubao_client.py:233`
- **ç”ŸæˆæœåŠ¡**ï¼š`services/generate/service.py:66`

#### é…ç½®æ–‡ä»¶

- **é¡¹ç›®é…ç½®**ï¼š`pyproject.toml`
- **ç¾å­¦é…ç½®**ï¼š`config/config.yaml`
- **ç¾å­¦æç¤ºè¯**ï¼š`prompts/doubao_aesthetic.prompt`
- **OpenAPIè§„èŒƒ**ï¼š`openapi.yaml`

#### æ–‡æ¡£

- **è‹±æ–‡README**ï¼š`README.md`
- **ä¸­æ–‡æ–‡æ¡£**ï¼š`doc/README.zh.md`
- **é¡¹ç›®ç¬”è®°**ï¼š`doc/PROJECT_NOTES.md`
- **æœ¬æ–‡æ¡£**ï¼š`doc/é¡¹ç›®å®Œæ•´æ–‡æ¡£.md`

#### å‰ç«¯

- **åº”ç”¨å…¥å£**ï¼š`frontend/src/main.tsx`
- **æ ¹ç»„ä»¶**ï¼š`frontend/src/App.tsx`
- **APIå°è£…**ï¼š`frontend/src/lib/api.ts`
- **ç±»å‹å®šä¹‰**ï¼š`frontend/src/types.ts`

### æœ¯è¯­è¡¨

| æœ¯è¯­ | è‹±æ–‡ | è¯´æ˜ |
|------|------|------|
| æä¾›å•† | Provider | å›¾åƒç”ŸæˆæœåŠ¡ï¼ˆå¦‚é€šä¹‰åƒé—®ã€è±†åŒ…ç­‰ï¼‰ |
| é€‚é…å™¨ | Adapter | å°è£…ä¸åŒæä¾›å•†APIçš„ç»Ÿä¸€æ¥å£å±‚ |
| ç®¡çº¿ | Pipeline | ç«¯åˆ°ç«¯çš„ç”Ÿæˆ+è¯„åˆ†+é€‰ä¼˜å·¥ä½œæµ |
| å€™é€‰å›¾ | Candidate | ç”Ÿæˆçš„å¾…è¯„åˆ†å›¾ç‰‡ |
| è¯„åˆ†æ¨¡å— | Scoring Module | ç‹¬ç«‹çš„è¯„åˆ†æœåŠ¡ï¼ˆå¦‚è‰²å½©è¯„åˆ†ã€æ„å›¾è¯„åˆ†ï¼‰ |
| èšåˆå™¨ | Aggregator | æ±‡æ€»å¤šä¸ªè¯„åˆ†æ¨¡å—ç»“æœçš„åè°ƒå™¨ |
| ç»¼åˆåˆ† | Composite Score | æœ€ç»ˆæ’åºä¾æ®çš„åˆ†æ•°ï¼ˆholisticï¼‰ |
| ç¾å­¦è¯„åˆ† | Aesthetic Scoring | åŸºäºè±†åŒ…Visionçš„å¤šç»´åº¦è¯„ä¼° |
| ä¸€è‡´æ€§æ£€æµ‹ | Consistency Check | å›¾ç”Ÿå›¾åœºæ™¯éªŒè¯ä¸»ä½“æ˜¯å¦ä¸€è‡´ |
| é™çº§ç­–ç•¥ | Fallback Strategy | ä¸»æœåŠ¡å¤±è´¥æ—¶çš„å¤‡ç”¨æ–¹æ¡ˆ |

### å‚è€ƒé“¾æ¥

- **FastAPIå®˜æ–¹æ–‡æ¡£**ï¼šhttps://fastapi.tiangolo.com/
- **Reactå®˜æ–¹æ–‡æ¡£**ï¼šhttps://react.dev/
- **è±†åŒ…å¤§æ¨¡å‹**ï¼šhttps://www.volcengine.com/docs/82379
- **é€šä¹‰åƒé—®**ï¼šhttps://help.aliyun.com/zh/dashscope/
- **OpenAI API**ï¼šhttps://platform.openai.com/docs/api-reference
- **Pydantic**ï¼šhttps://docs.pydantic.dev/
- **Tailwind CSS**ï¼šhttps://tailwindcss.com/

---

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- **GitHub Issues**ï¼šï¼ˆå¾…æ·»åŠ ï¼‰
- **é‚®ç®±**ï¼šï¼ˆå¾…æ·»åŠ ï¼‰
- **æ–‡æ¡£è´¡çŒ®**ï¼šå‚è€ƒ `CONTRIBUTING.md`

---

