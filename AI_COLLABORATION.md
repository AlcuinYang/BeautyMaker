# 🤖 AI 协作开发指南

**BeautyMaker 项目多 AI 协同工作手册**

> 本文档定义了 Claude、Gemini、Codex 三个 AI 助手在 BeautyMaker 项目中的角色分工、协作流程和最佳实践。

---

## 📋 目录

1. [团队构成与角色定位](#团队构成与角色定位)
2. [快速决策树：什么时候用谁？](#快速决策树什么时候用谁)
3. [详细使用场景](#详细使用场景)
4. [协作工作流](#协作工作流)
5. [具体任务分配矩阵](#具体任务分配矩阵)
6. [最佳实践与注意事项](#最佳实践与注意事项)
7. [项目特定指导](#项目特定指导)

---

## 🎯 团队构成与角色定位

### 1. Claude 3.5 Sonnet (claude-sonnet-4-5-20250929)

**角色：** 首席架构师 / Tech Lead

**核心优势：**
- ✅ **逻辑推理最强**：复杂的架构设计和算法实现
- ✅ **代码质量最高**：生成的代码几乎不需要修改就能运行
- ✅ **重构能力出色**：擅长重构遗留代码和优化架构
- ✅ **测试覆盖完善**：自动生成高质量测试用例

**最佳使用场景：**
1. **架构设计**
   - 设计新的服务模块
   - 重构现有架构
   - 制定技术方案

2. **核心功能开发**
   - 实现复杂的业务逻辑
   - 编写关键的服务层代码
   - 开发新的 Provider 适配器

3. **Bug 修复**
   - 解决复杂的逻辑 Bug
   - 调试异步并发问题
   - 修复性能瓶颈

4. **测试与质量**
   - 编写单元测试和集成测试
   - Code Review 并提出改进建议
   - 性能优化和安全审查

5. **文档编写**
   - 编写技术文档和 API 文档
   - 创建架构说明
   - 撰写 README 和贡献指南

**工作方式：**
- 通过 Claude Code CLI 交互
- 可以执行命令、读写文件、运行测试
- 适合需要深度思考的任务

---

### 2. Gemini 1.5 Pro

**角色：** 产品经理 / 视觉总监 / 全局审查员

**核心优势：**
- ✅ **超大上下文窗口**：可一次性读取整个项目代码
- ✅ **多模态能力**：可以"看懂"UI 截图、设计稿、视频
- ✅ **全局视角**：擅长发现跨文件的问题和不一致性
- ✅ **文档理解**：快速消化长文档、论文、API 文档

**最佳使用场景：**
1. **全局 Code Review**
   - 检查整个项目的代码一致性
   - 发现跨模块的重复代码
   - 审查命名规范和代码风格

2. **需求分析与转化**
   - 阅读产品文档/PRD 并转化为技术方案
   - 分析竞品功能并提出实现建议
   - 从用户反馈中提取需求

3. **UI/UX 走查**
   - 查看 UI 截图并指出问题
   - 对比设计稿与实际效果
   - 提出视觉优化建议

4. **文档研究**
   - 阅读第三方 API 文档（如豆包、通义千问）
   - 分析技术论文并应用到项目
   - 整理和总结长篇技术文档

5. **全局重构建议**
   - 发现项目级的架构问题
   - 提出大规模重构方案
   - 统一技术栈和依赖

**工作方式：**
- 通过 Google AI Studio 或 API
- 适合上传整个项目或长文档
- 擅长宏观分析和视觉任务

---

### 3. Codex (GitHub Copilot)

**角色：** 结对编程伙伴 (Pair Programmer)

**核心优势：**
- ✅ **响应速度极快**：实时补全，无需等待
- ✅ **IDE 深度集成**：无需切换窗口，专注编码
- ✅ **上下文感知**：根据当前文件和光标位置智能补全
- ✅ **样板代码生成**：快速生成常见模式

**最佳使用场景：**
1. **代码自动补全**
   - 函数体自动补全
   - 重复模式代码生成
   - Import 语句自动添加

2. **样板代码生成**
   - CRUD 操作
   - 数据模型定义
   - 路由处理器

3. **注释与文档**
   - 自动生成函数注释
   - 快速添加类型注解
   - 生成 docstring

4. **代码解释**
   - 解释选中代码的含义
   - 提供重构建议
   - 查找相关代码

5. **快速原型**
   - 快速搭建基础结构
   - 生成测试数据
   - 创建 Mock 对象

**工作方式：**
- 集成在 VS Code / JetBrains IDE
- 实时补全，Tab 接受建议
- Copilot Chat 用于对话式编程

---

## 🌲 快速决策树：什么时候用谁？

```
开始新任务
    │
    ├─ 需要理解整个项目结构？
    │   └─ 是 → 用 Gemini (上传全部代码)
    │
    ├─ 需要看 UI/设计稿？
    │   └─ 是 → 用 Gemini (多模态能力)
    │
    ├─ 需要阅读长文档/API 文档？
    │   └─ 是 → 用 Gemini (超大上下文)
    │
    ├─ 需要设计复杂架构或算法？
    │   └─ 是 → 用 Claude (逻辑推理最强)
    │
    ├─ 需要编写核心业务逻辑？
    │   └─ 是 → 用 Claude (代码质量最高)
    │
    ├─ 需要修复复杂 Bug？
    │   └─ 是 → 用 Claude (调试能力强)
    │
    ├─ 需要编写测试用例？
    │   └─ 是 → 用 Claude (测试覆盖最全)
    │
    ├─ 正在写代码，需要快速补全？
    │   └─ 是 → 用 Codex (IDE 集成)
    │
    ├─ 需要生成样板代码 (CRUD、Model)？
    │   └─ 是 → 用 Codex (速度最快)
    │
    └─ 需要解释当前代码？
        └─ 是 → 用 Codex (光标位置上下文)
```

---

## 📖 详细使用场景

### 场景 1：添加新的图像生成提供商

**任务：** 为 BeautyMaker 添加一个新的图像生成提供商（如 Midjourney API）

| 步骤 | 使用 AI | 具体操作 |
|------|---------|----------|
| 1. 阅读 API 文档 | **Gemini** | 上传 Midjourney API 文档，让 Gemini 总结关键参数和调用方式 |
| 2. 设计适配器架构 | **Claude** | 根据 `services/generate/adapters/base.py` 设计新适配器 |
| 3. 实现适配器代码 | **Claude** | 编写 `midjourney.py`，包含完整的错误处理和日志 |
| 4. 补充样板代码 | **Codex** | 在 IDE 中快速补全重复的 HTTP 请求模式 |
| 5. 编写测试用例 | **Claude** | 创建 `tests/test_midjourney.py` 并覆盖各种场景 |
| 6. 注册到系统 | **Codex** | 在 `__init__.py` 和 `provider_info.py` 中添加注册代码 |
| 7. 全局 Review | **Gemini** | 检查新代码是否与现有提供商风格一致 |

---

### 场景 2：修复豆包 API 调用失败的 Bug

**任务：** 豆包美学评分 API 偶尔返回 400 错误

| 步骤 | 使用 AI | 具体操作 |
|------|---------|----------|
| 1. 查看错误日志 | **Claude** | 读取 `logs/doubao_events.jsonl`，分析失败模式 |
| 2. 复现 Bug | **Claude** | 编写测试用例复现问题 |
| 3. 调试根因 | **Claude** | 分析 `doubao_client.py` 的请求构建逻辑 |
| 4. 查阅豆包文档 | **Gemini** | 上传豆包 Vision API 文档，确认正确的请求格式 |
| 5. 修复代码 | **Claude** | 修改请求构建逻辑，添加参数验证 |
| 6. 添加重试机制 | **Claude** | 实现指数退避重试策略 |
| 7. 补全日志代码 | **Codex** | 快速添加详细的调试日志 |
| 8. 验证修复 | **Claude** | 运行测试并检查日志 |

---

### 场景 3：优化前端 UI 体验

**任务：** 前端评分雷达图显示不美观，需要优化

| 步骤 | 使用 AI | 具体操作 |
|------|---------|----------|
| 1. 截图当前 UI | **Gemini** | 上传当前雷达图截图，让 Gemini 指出问题 |
| 2. 提供设计建议 | **Gemini** | 基于 Apple 设计风格提出优化方案 |
| 3. 修改组件代码 | **Claude** | 重构 `ScoreRadarChart.tsx`，优化布局和动画 |
| 4. 调整样式细节 | **Codex** | 快速补全 Tailwind CSS 类名 |
| 5. 添加动画效果 | **Claude** | 使用 Framer Motion 添加流畅过渡 |
| 6. 对比前后效果 | **Gemini** | 上传新旧截图，评估改进效果 |

---

### 场景 4：实现文生图参考图功能

**任务：** 在文生图 pipeline 中添加参考图支持

| 步骤 | 使用 AI | 具体操作 |
|------|---------|----------|
| 1. 分析需求 | **Gemini** | 阅读产品需求文档，理解参考图的用途 |
| 2. 检查现有实现 | **Claude** | 阅读 `text2image.py` 和 `qwen.py`，了解当前架构 |
| 3. 设计方案 | **Claude** | 设计 API 参数和数据流 |
| 4. 修改 Pipeline | **Claude** | 在 `Text2ImagePipelineRequest` 添加 `reference_images` |
| 5. 更新提供商调用 | **Claude** | 修改 `_generate_candidates` 传递参考图 |
| 6. 快速补全重复代码 | **Codex** | 补全参数验证和类型注解 |
| 7. 前端添加上传组件 | **Claude** | 创建图片上传组件（支持 base64 和 URL） |
| 8. 编写测试 | **Claude** | 测试各种参考图格式和边界情况 |
| 9. 全局一致性检查 | **Gemini** | 确保新功能与图生图 pipeline 风格一致 |

---

## 🔄 协作工作流

### 典型开发流程

```
1. 需求分析阶段
   └─ Gemini: 阅读需求文档 + 竞品分析
       └─ 输出：技术方案草稿

2. 架构设计阶段
   └─ Claude: 设计模块架构 + API 接口
       └─ 输出：技术设计文档 + 代码骨架

3. 编码实现阶段
   ├─ Claude: 实现核心逻辑
   ├─ Codex: 补全样板代码和注释
   └─ Claude: 编写测试用例

4. Review 阶段
   ├─ Gemini: 全局代码一致性检查
   └─ Claude: 深度 Code Review + 重构建议

5. 优化阶段
   └─ Claude: 性能优化 + 安全加固
```

### 每日工作流建议

**早上（规划 + 设计）**
- 用 **Gemini** 回顾昨天的进度，阅读团队文档
- 用 **Claude** 设计今天的技术方案

**白天（编码）**
- 用 **Claude** 实现核心功能
- 用 **Codex** 快速补全样板代码
- 遇到 UI 问题用 **Gemini** 看图分析

**晚上（Review + 总结）**
- 用 **Gemini** 做全局 Code Review
- 用 **Claude** 编写测试和文档
- 提交代码并记录问题

---

## 📊 具体任务分配矩阵

| 任务类型 | Claude | Gemini | Codex | 说明 |
|---------|:------:|:------:|:-----:|------|
| **架构设计** | ⭐⭐⭐ | ⭐⭐ | - | Claude 主导，Gemini 提供全局视角 |
| **核心业务逻辑** | ⭐⭐⭐ | - | ⭐ | Claude 编写，Codex 补全 |
| **Provider 适配器** | ⭐⭐⭐ | ⭐ | ⭐ | Claude 实现，Gemini 读文档，Codex 补全 |
| **Pipeline 开发** | ⭐⭐⭐ | ⭐ | ⭐ | Claude 主导 |
| **API 端点** | ⭐⭐⭐ | - | ⭐⭐ | Claude 实现，Codex 快速生成 |
| **数据模型** | ⭐⭐ | - | ⭐⭐⭐ | Codex 快速生成，Claude 优化 |
| **前端组件** | ⭐⭐⭐ | ⭐⭐ | ⭐⭐ | Claude 实现，Gemini 看图，Codex 补全 |
| **样式调整** | ⭐ | ⭐⭐⭐ | ⭐⭐ | Gemini 看图建议，Codex 快速实现 |
| **测试用例** | ⭐⭐⭐ | - | ⭐ | Claude 主导 |
| **Bug 修复** | ⭐⭐⭐ | ⭐ | ⭐ | Claude 调试，Gemini 提供上下文 |
| **性能优化** | ⭐⭐⭐ | ⭐ | - | Claude 主导 |
| **安全审查** | ⭐⭐⭐ | ⭐⭐ | - | Claude 深度分析，Gemini 全局扫描 |
| **代码重构** | ⭐⭐⭐ | ⭐⭐ | - | Claude 重构，Gemini 检查一致性 |
| **文档编写** | ⭐⭐⭐ | ⭐⭐ | ⭐ | Claude 主导 |
| **全局 Review** | ⭐⭐ | ⭐⭐⭐ | - | Gemini 最擅长 |
| **UI/UX 走查** | ⭐ | ⭐⭐⭐ | - | Gemini 多模态能力 |
| **API 文档研究** | ⭐⭐ | ⭐⭐⭐ | - | Gemini 超大上下文 |
| **样板代码生成** | ⭐ | - | ⭐⭐⭐ | Codex 最快 |
| **代码补全** | ⭐ | - | ⭐⭐⭐ | Codex IDE 集成 |
| **注释生成** | ⭐⭐ | - | ⭐⭐⭐ | Codex 快速生成 |

**图例：** ⭐⭐⭐ 最适合 | ⭐⭐ 适合 | ⭐ 可以但非最优 | - 不推荐

---

## ✅ 最佳实践与注意事项

### Claude 使用最佳实践

1. **明确任务目标**
   - ✅ 好："实现豆包 API 重试机制，使用指数退避，最多重试 3 次"
   - ❌ 差："优化一下豆包调用"

2. **提供足够上下文**
   - 让 Claude 先读相关文件
   - 说明现有架构和约束
   - 指出需要遵循的规范（如 CONTRIBUTING.md）

3. **利用工具能力**
   - 让 Claude 运行测试验证代码
   - 使用 grep/glob 搜索相关代码
   - 查看日志文件辅助调试

4. **分步骤执行**
   - 复杂任务拆分成小步骤
   - 每步验证后再继续
   - 使用 TodoWrite 工具追踪进度

### Gemini 使用最佳实践

1. **充分利用上下文窗口**
   - 一次性上传整个项目代码
   - 上传长文档（API 文档、论文）
   - 提供完整的历史对话

2. **多模态能力最大化**
   - 上传 UI 截图请求分析
   - 提供设计稿对比实现
   - 分享错误截图辅助调试

3. **全局视角任务**
   - 检查命名一致性
   - 发现重复代码
   - 审查架构合理性

### Codex 使用最佳实践

1. **写好注释触发补全**
   ```python
   # Generate a function that validates email format
   # (Codex 会自动补全完整函数)
   ```

2. **利用上下文**
   - 确保相关文件已打开
   - 光标放在正确位置
   - 提供类型注解帮助推断

3. **快速迭代**
   - Tab 接受建议
   - Esc 拒绝建议
   - 快速试错调整

---

## 🎯 项目特定指导

### BeautyMaker 项目关键点

#### 1. 添加新 Provider 的标准流程

```
Step 1: 研究 API 文档
  └─ 使用 Gemini 阅读并总结

Step 2: 实现适配器
  └─ 使用 Claude 编写 services/generate/adapters/xxx.py
      - 继承 BaseProvider
      - 实现 generate() 方法
      - 处理 text2image / image2image
      - 添加完整的错误处理和日志

Step 3: 注册 Provider
  └─ 使用 Codex 快速添加到：
      - services/generate/__init__.py
      - services/generate/routes/provider_info.py

Step 4: 编写测试
  └─ 使用 Claude 创建 tests/test_xxx.py

Step 5: 全局检查
  └─ 使用 Gemini 检查与其他 Provider 的一致性
```

#### 2. 修改 Pipeline 的标准流程

```
Step 1: 理解现有流程
  └─ 使用 Claude 阅读 services/pipeline/xxx.py

Step 2: 设计改动方案
  └─ 使用 Claude 设计新的数据流和 API

Step 3: 实现修改
  └─ 使用 Claude 修改 Pipeline 代码
  └─ 使用 Codex 补全样板代码

Step 4: 更新前端
  └─ 使用 Claude 修改前端组件
  └─ 使用 Gemini 检查 UI 效果

Step 5: 测试验证
  └─ 使用 Claude 编写测试用例
```

#### 3. 豆包 API 相关任务

**阅读豆包文档：** Gemini
**实现调用逻辑：** Claude
**调试 400 错误：** Claude
**优化重试策略：** Claude
**补全日志代码：** Codex

#### 4. 前端 UI 优化

**截图分析：** Gemini
**组件重构：** Claude
**样式调整：** Codex + Gemini
**动画实现：** Claude

---

## 🚨 常见陷阱与解决方案

### 陷阱 1：让 Codex 做复杂逻辑

❌ **错误做法：** 让 Codex 实现复杂的异步重试逻辑
✅ **正确做法：** 用 Claude 实现核心逻辑，Codex 补全样板部分

### 陷阱 2：让 Claude 做快速补全

❌ **错误做法：** 来回切换窗口问 Claude 补全代码
✅ **正确做法：** 编码时用 Codex 实时补全，完成后让 Claude Review

### 陷阱 3：忽略 Gemini 的全局视角

❌ **错误做法：** 改完代码直接提交
✅ **正确做法：** 让 Gemini 检查改动是否影响其他模块

### 陷阱 4：没有明确任务边界

❌ **错误做法：** "帮我优化一下项目"
✅ **正确做法：** "用 Claude 重构 doubao_client.py 的重试逻辑，用 Gemini 检查日志一致性"

---

## 📝 协作检查清单

### 开始新功能前

- [ ] 用 Gemini 阅读相关文档和需求
- [ ] 用 Claude 设计技术方案
- [ ] 确认哪些部分用 Codex 快速实现

### 编码过程中

- [ ] 核心逻辑用 Claude 实现
- [ ] 样板代码用 Codex 补全
- [ ] 遇到 UI 问题截图给 Gemini

### 提交代码前

- [ ] 用 Claude 运行测试
- [ ] 用 Gemini 做全局一致性检查
- [ ] 用 Claude 编写/更新文档

### Code Review 时

- [ ] Gemini：检查全局影响
- [ ] Claude：深度逻辑审查
- [ ] Codex：补充注释和文档

---

## 🎓 进阶技巧

### 技巧 1：三 AI 接力开发

```
Gemini (分析文档)
  → Claude (设计方案 + 核心实现)
    → Codex (补全细节)
      → Gemini (全局 Review)
        → Claude (修复问题)
```

### 技巧 2：并行开发

```
同时进行：
- Claude 实现后端 API
- Codex 快速搭建前端组件框架
- Gemini 准备测试用例列表

然后汇总集成
```

### 技巧 3：问题升级机制

```
遇到问题时：
1. Codex 尝试快速修复 (30秒)
2. 失败 → Claude 深度调试 (5分钟)
3. 仍失败 → Gemini 全局分析 (找根因)
4. 解决后 → Claude 优化方案
```

---

## 📚 延伸阅读

- [AGENTS.md](./AGENTS.md) - Claude Code 开发指南
- [CONTRIBUTING.md](./CONTRIBUTING.md) - 代码规范
- [完整项目文档](./doc/项目完整文档.md) - BeautyMaker 架构详解

---

<div align="center">

**三 AI 协作，开发效率 10x！🚀**

</div>
